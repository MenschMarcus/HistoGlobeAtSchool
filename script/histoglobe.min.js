function timeline(t){function e(){function t(){var e=.618*ee.offsetWidth,n=le-ee.scrollLeft;Math.abs(e-n)>3?(R((e-n)/3,!0),setTimeout(t,50)):(R(e-n,!0),he=.1*ee.offsetWidth,d())}He.date=1825,He.marker=$("#nowMarkerWrap")[0],He.marker.markerDate=He,Q=1820,te=1845,ee=$("#tlMain")[0],ne=$("#tlScroller")[0],ie=$("#tlDateMarkers")[0],re=He.date,oe=0,se=0,le=0,ae=.05,he=0,ue=0,fe=8e3,ce=null,ve=1600,me=!1,de=!1,ye=0,pe=0,ge=null,xe=null,C(),$("#polDate").text(j(He.date)),$(ne).width(1.5*$("#tlMain").width()),g(),setTimeout(t,300)}function n(){he=.1*ee.offsetWidth,$(ne).width(1.5*ee.offsetWidth),g()}function i(t){t=t?_(t):He.date;var e=O(t);r(e),m()}function r(t){var e=Math.max(O(Q),$(ee).scrollLeft()+He.marker.offsetWidth/2),n=Math.min(O(te),ee.offsetWidth+$(ee).scrollLeft()-He.marker.offsetWidth/2);t=Math.min(n,Math.max(e,t)),He.date=N(t),$(He.marker).css("left",t),$("#polDate").text(j(He.date))}function o(){var t=O(He.date),e=$("#tlMain").scrollLeft()+he,n=$("#tlMain").scrollLeft()+$("#tlMain").width()-he;t>=e&&n>=t||(He.date=e>t?N(e):N(n),$("#polDate").text(j(He.date)),$(He.marker).css("left",O(He.date)),m())}function a(t,e){if(t>e){var n=t;t=e,e=n}t=Math.max(t,Q),e=Math.min(e,te),3>e-t&&(te-3>e?e=t+3:t=e-3),ae=ee.offsetWidth/B(t,e),re=He.date,oe=B(t,He.date)*ae+$(ee).scrollLeft(),g(),o(),d()}function s(t){we[0]=t[0].lon,we[1]=t[0].lat,we[2]=t[1].lon,we[3]=t[1].lat;var e=Me;for(var n in e){var i=Me[n].data.properties.lon,r=Me[n].data.properties.lat,o=$("#event"+Me[n].data.properties.histEventID);i<=we[2]&&i>=we[0]&&r<=we[3]&&r>=we[1]?o.css("display","block"):o.css("display","none")}}function l(t){Me=t}function h(){return He}function u(){return F(0)}function f(){return F(ee.offsetWidth)}function c(){var t=$("#catSociety").is(":checked"),e=$("#catDomestic").is(":checked"),n=$("#catForeign").is(":checked");return{social:t,domestic:e,foreign:n,asUrlParam:function(){return(t?"&social=1":"&social=0")+(e?"&domestic=1":"&domestic=0")+(n?"&foreign=1":"&foreign=0")}}}function v(t){Ce.push(t),t.nowChanged(X(He.date)),t.periodChanged(F(0),F(ee.offsetWidth)),t.categoryChanged(c())}function m(){var t=X(He.date);for(var e in Ce)Ce[e].nowChanged(t)}function d(){var t=F($(ee).scrollLeft()),e=F(ee.offsetWidth+$(ee).scrollLeft());for(var n in Ce)Ce[n].periodChanged(t,e)}function y(){p()}function p(){var t=c();for(var e in Ce)Ce[e].categoryChanged(t)}function g(){$(".eventMarker").remove(),$(".yearMarker").remove();for(var t=45,e=[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],n=0;365.242199*ae<t/e[n];)n++;ue=e[n],$(He.marker).css("left",O(He.date));var i=Math.ceil(He.date);i+=ue-i%ue,i>te&&(i-=ue),$("#tlDateMarkers").append(M(i)),se=le=O(i),x();var r=Math.max(Math.round(N($(ee).scrollLeft())),Q),o=Math.min(Math.round(N(ee.offsetWidth+$(ee).scrollLeft())),Math.floor(te));$("#periodStart").val(r),$("#periodEnd").val(o),b()}function x(){for(;se>0;){var t=Math.round(N(se))-ue;if(Q>t)break;$("#tlDateMarkers").prepend(M(t)),se=O(t)}for(;le<ne.offsetWidth;){var e=Math.round(N(le))+ue;if(e>te)break;$("#tlDateMarkers").append(M(e)),le=O(e)}}function H(){for(;0>=se;){$("#tlDateMarkers > div.yearMarker:first").remove();var t=Math.round(N(se));se=O(t+ue)}for(;le>=ne.offsetWidth;){$("#tlDateMarkers > div.yearMarker:last").remove();var e=Math.round(N(le));le=O(e-ue)}}function M(t){var e=document.createElement("div");return e.setAttribute("id",t),e.setAttribute("class","yearMarker "+w(t)),e.style.left=O(t)+"px",e.innerHTML="<p>"+t+"</p>",e.markerDate={date:t},e}function w(t){return 0==t%(20*ue)?"yearMark1":0==t%(5*ue)?"yearMark2":"yearMark3"}function C(){t.onHiventsLoaded(function(t){for(var e=0;e<t.length;e++){var n=t[e].getHivent(),i=new Date(n.date),r=W(i),o=new HG.HiventMarkerTimeline(t[e],ne,r);be.push(o)}})}function b(){for(var t=0;t<be.length;t++){var e=new Date(be[t].getHiventHandle().getHivent().date),n=W(e);be[t].setPosition(n)}}function L(t,e){return 1==$(t.target).closest(e).length}function k(t){var e=$("#histPlayer1"),n=$("#histPlayer2"),i=$("#histPlayer3"),r=null;e.hasClass("active")&&(r=1),n.hasClass("active")&&(r=2),i.hasClass("active")&&(r=3);var o=null;L(t,e)&&(o=1),L(t,n)&&(o=2),L(t,i)&&(o=3),T(),1==o&&e.button("toggle"),2==o&&n.button("toggle"),3==o&&i.button("toggle"),r!=o&&(1==r&&e.button("toggle"),2==r&&n.button("toggle"),3==r&&i.button("toggle"),S(o))}function S(t){var e=0;ce=setInterval(function(){var n=O(He.date);n+=5*t;var i=0;if(he>n?i=he-n:n>ee.offsetWidth-he&&(i=ee.offsetWidth-he-n),0!=i){var o;setTimeout(o=function(){Math.abs(i)<1||(R(i/2),i/=2,setTimeout(o,20))},20)}if(r(n),He.date>=te){T();var a=$("#histPlayer1"),s=$("#histPlayer2"),l=$("#histPlayer3");a.hasClass("active")&&a.button("toggle"),s.hasClass("active")&&s.button("toggle"),l.hasClass("active")&&l.button("toggle")}50==e&&(m(),d(),e=0),e++},10)}function T(){clearInterval(ce),ce=null,$(He.marker).stop()}function G(t){return 1==t.which?($("body").attr("style","cursor: move;"),ye=t.pageX,pe=0,"nowMarkerMain"==t.target.id||"nowMarkerHead"==t.target.id?(de=!0,void 0):("polDate"!=t.target.id&&(me=!0),void 0)):void 0}function P(t){var e=t.pageX-ye;pe+=Math.abs(e),me&&(R(e),o()),de&&A(t),ye=t.pageX}function E(t){$("body").attr("style",""),(me||ge)&&d(),me&&5>pe&&i(Y(t));var e=$(He.marker).position().left-$(ee).scrollLeft(),n=0;if(he>e?n=he-e:e>ee.offsetWidth-he&&(n=ee.offsetWidth-he-e),0!=n){var r;setTimeout(r=function(){Math.abs(n)<1||(R(n/2),n/=2,setTimeout(r,50))},50)}i(),me=!1,de=!1,clearInterval(ge),ge=null}function z(t){var e=t,n=(new Date).getTime();clearInterval(ge),ge=setInterval(function(){var t=(new Date).getTime(),i=Math.min(.05,(t-n)/5e4);e>0?U(0,e+i):U(0,e-i),o()},20)}function D(t){var e=t,n=(new Date).getTime();clearInterval(ge),ge=setInterval(function(){var t=(new Date).getTime(),i=Math.min(.05,(t-n)/5e4);e>0?U($("#tlMain").width()-0,e+i):U($("#tlMain").width()-0,e-i),o()},20)}function R(t,e){var n=ne.offsetWidth/3;if(e||(t=Math.min(t,.382*ee.offsetWidth-(se-ee.scrollLeft)),t=Math.max(t,.618*ee.offsetWidth-(le-ee.scrollLeft))),0!=t){ee.scrollLeft-t<=0?(I(n),$("#tlMain").scrollLeft(ee.scrollLeft+n)):ee.scrollLeft-t>=ne.offsetWidth-ee.offsetWidth&&(I(-n),$("#tlMain").scrollLeft(ee.scrollLeft-n)),$("#tlMain").scrollLeft(ee.scrollLeft-t);var i=Math.ceil(N(ee.scrollLeft)),r=Math.floor(N(ee.scrollLeft+ee.offsetWidth));$("#periodStart").val(Math.max(i,Q)),$("#periodEnd").val(Math.min(r,Math.floor(te)))}}function I(t){var e=$("#tlDateMarkers > div");e.each(function(){$(this).css("left",O(this.markerDate.date)+t)}),oe+=t,se+=t,le+=t,b(),x(),H()}function A(t){var e=.2;if(xe=t,null===ge){var n=0;ge=setInterval(function(){var t=xe.pageX-$(ee).offset().left;if(he>t){var i=(he-t)*e;R(i)}else if(t>ee.offsetWidth-he){var i=(ee.offsetWidth-he-t)*e;R(i)}var o=t+$(ee).scrollLeft();r(o),0==++n%5&&(m(),d())},20)}}function U(t,e){var n={pageX:t+$("#tlMain").offset().left};V(n,e)}function V(t,e){t.preventDefault&&t.preventDefault();var n=1.15,i=ee.offsetWidth/B(Q,te),r=.45;t?(re=Y(t),oe=t.pageX-$("#tlScroller").offset().left):(re=N(ee.offsetWidth/2),oe=ee.offsetWidth/2),ae*=Math.pow(n,e),ae=Math.min(Math.max(ae,i),r),g(),o(),se-ee.scrollLeft>=.382*ee.offsetWidth?R(.382*ee.offsetWidth-(se-ee.scrollLeft)):le-ee.scrollLeft<=.618*ee.offsetWidth&&R(.618*ee.offsetWidth-(le-ee.scrollLeft)),o(),d()}function W(t){return t=Z(t),B(re,t)*ae+oe}function O(t){return B(re,t)*ae+oe}function F(t){var e=re+(t-oe)/ae/365.242199;return X(e)}function N(t){return re+(t-oe)/ae/365.242199}function j(t){var e=X(t);return q(e.getDate())+"."+q(e.getMonth()+1)+"."+e.getFullYear()}function X(t){if(t instanceof Date)return t;var e=Math.floor(t);return K(e)?new Date(e,0,366*(t-e)+1,0,0,0):new Date(e,0,365*(t-e)+1,0,0,0)}function Z(t){var e=t.getFullYear(),n=B(new Date(e,0,1),t);return K(e)?e+n/366:e+n/365}function _(t){if(t instanceof Date)return Z(t);if(!isNaN(t))return t;var e=String(t).split("."),n=new Date(e[2],e[1]-1,e[0]);return Z(n)}function Y(t){var e=t.pageX-$("#tlScroller").offset().left;return N(e)}function B(t,e){0==t instanceof Date&&(t=X(t)),0==e instanceof Date&&(e=X(e));var n=e.getTime()-t.getTime();return n/864e5}function K(t){return 0==t%4?0==t%100?0==t%400?!0:!1:!0:!1}function q(t){return 10>t?"0"+t:t}var J={};J.initTimeline=e,J.resizeTimeline=n,J.drawScroller=g,J.setNowDate=i,J.setPeriod=a,J.setHistEvents=l,J.setMapExtent=s,J.getNow=h,J.getPeriodStart=u,J.getPeriodEnd=f,J.getCategories=c,J.addListener=v,J.catChangeHandler=y,J.clickMouse=G,J.moveMouse=P,J.releaseMouse=E,J.clickMoveButtonLeft=D,J.clickMoveButtonRight=z,J.zoom=V,J.togglePlayer=k;var Q,te,ee,ne,ie,re,oe,ae,se,le,he,ue,fe,ce,ve,me,de,ye,pe,ge,xe,He={},Me=[],we=[],Ce=[],be=[];return J}!function(){null==window.HG&&(window.HG={}),HG.Display=function(){function t(){}return t.prototype.focus=function(t){return this.center({x:t.long,y:t.lat})},t}()}.call(this);var HG=HG||{};HG.Display2D=function(t,e){function n(){s=document.createElement("div"),s.style.width=$(t.parentNode).width()+"px",s.style.height=$(t.parentNode).height()+"px",t.appendChild(s),a=L.map(s,{maxZoom:7,minZoom:1,zoomControl:!1}).setView([51.505,10.09],4),a.attributionControl.setPrefix(""),L.tileLayer("data/tiles/{z}/{x}/{y}.png").addTo(a),u=!0}function i(){window.addEventListener("resize",o,!1)}function r(){e.onHiventsLoaded(function(t){for(var e=0;e<t.length;e++){var n=new HG.HiventMarker2D(t[e],l,a);h.push(n)}}),a.on("click",HG.deactivateAllHivents)}function o(){s.style.width=$(t.parentNode).width()+"px",s.style.height=$(t.parentNode).height()+"px"}HG.Display2D.MAX_ZOOM=1.5,HG.Display2D.MIN_ZOOM=.1,this.create=function(){n(),i(),r()},this.start=function(){u||(u=!0,s.style.display="block")},this.stop=function(){u=!1,s.style.display="none"},this.isRunning=function(){return u},this.getCanvas=function(){return s},this.center=function(t){a.panTo([t.y,t.x])};var a,s,l=this,h=[],u=!1;return HG.Display.call(this),this.create(),this},HG.Display2D.prototype=Object.create(HG.Display.prototype),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};null==window.HG&&(window.HG={}),HG.Display3D=function(e){function i(e,n){this.inContainer=e,this.inHiventHandler=n,this.onMouseWheel=t(this.onMouseWheel,this),this.onMouseUp=t(this.onMouseUp,this),this.onMouseMove=t(this.onMouseMove,this),this.onMouseDown=t(this.onMouseDown,this),this.myWidth=void 0,this.myHeight=void 0,this.mySelf=this,this.myCamera=void 0,this.myRenderer=void 0,this.mySceneGlobe=void 0,this.mySceneAtmosphere=void 0,this.myCanvasOffsetX=void 0,this.myCanvasOffsetY=void 0,this.myLastIntersected=[],this.myCurrentCameraPos={x:0,y:0},this.myTargetCameraPos={x:0,y:0},this.myMousePos={x:0,y:0},this.myMousePosLastFrame={x:0,y:0},this.myMouseSpeed={x:0,y:0},this.myDragStartPos=void 0,this.mySpringiness=.9,this.myCurrentFOV=0,this.myTargetFOV=0,this.myGlobeTextures=[],this.myGlobeUniforms=void 0,this.myIsRunning=!1,this.myCurrentZoom=u,this.myIsZooming=!1,this.initWindowGeometry(),console.log(this.myWidth),this.initGlobe(),this.initRenderer(),this.initHivents(),this.initEventHandling(),this.zoom(),this.center({x:10,y:50})}var r,o,a,s,l,h,u,f,c,v,m,d,y;return n(i,e),v=new THREE.Projector,m=new THREE.Raycaster,r=new THREE.Color(13421772),y="data/tiles/",c=200,o=500,l=7,u=3,a=60,h=4,s=80,f=.1,d={earth:{uniforms:{tiles:{type:"tv",value:[]},opacity:{type:"f",value:0},minUV:{type:"v2",value:null},maxUV:{type:"v2",value:null}},vertexShader:["varying vec3 vNormal;","varying vec2 vTexcoord;","float convertCoords(float lat) {","if (lat == 0.0) return 0.0;","if (lat == 1.0) return 1.0;","const float pi = 3.1415926535897932384626433832795;","return log(tan(lat*0.5 * pi)) / (pi * 2.0) + 0.5;","}","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","vTexcoord = vec2(uv.x, convertCoords(uv.y));","}"].join("\n"),fragmentShader:["uniform sampler2D tiles[16];","uniform float opacity;","uniform vec2 minUV;","uniform vec2 maxUV;","varying vec3 vNormal;","varying vec2 vTexcoord;","void main() {","if (minUV.x > vTexcoord.x || maxUV.x < vTexcoord.x ||","minUV.y > vTexcoord.y || maxUV.y < vTexcoord.y)","discard;","vec2 uv = (vTexcoord - minUV)/(maxUV - minUV);","vec3 diffuse = vec3(0);","float size = 0.25;","if      (uv.x < 1.0*size && uv.y < 1.0*size)","diffuse = texture2D( tiles[ 0], uv * 4.0 - vec2(1, 1) + vec2(1, 1)).xyz;","else if (uv.x < 1.0*size && uv.y < 2.0*size)","diffuse = texture2D( tiles[ 1], uv * 4.0 - vec2(1, 2) + vec2(1, 1)).xyz;","else if (uv.x < 1.0*size && uv.y < 3.0*size)","diffuse = texture2D( tiles[ 2], uv * 4.0 - vec2(1, 3) + vec2(1, 1)).xyz;","else if (uv.x < 1.0*size && uv.y < 4.0*size)","diffuse = texture2D( tiles[ 3], uv * 4.0 - vec2(1, 4) + vec2(1, 1)).xyz;","else if (uv.x < 2.0*size && uv.y < 1.0*size)","diffuse = texture2D( tiles[ 4], uv * 4.0 - vec2(2, 1) + vec2(1, 1)).xyz;","else if (uv.x < 2.0*size && uv.y < 2.0*size)","diffuse = texture2D( tiles[ 5], uv * 4.0 - vec2(2, 2) + vec2(1, 1)).xyz;","else if (uv.x < 2.0*size && uv.y < 3.0*size)","diffuse = texture2D( tiles[ 6], uv * 4.0 - vec2(2, 3) + vec2(1, 1)).xyz;","else if (uv.x < 2.0*size && uv.y < 4.0*size)","diffuse = texture2D( tiles[ 7], uv * 4.0 - vec2(2, 4) + vec2(1, 1)).xyz;","else if (uv.x < 3.0*size && uv.y < 1.0*size)","diffuse = texture2D( tiles[ 8], uv * 4.0 - vec2(3, 1) + vec2(1, 1)).xyz;","else if (uv.x < 3.0*size && uv.y < 2.0*size)","diffuse = texture2D( tiles[ 9], uv * 4.0 - vec2(3, 2) + vec2(1, 1)).xyz;","else if (uv.x < 3.0*size && uv.y < 3.0*size)","diffuse = texture2D( tiles[10], uv * 4.0 - vec2(3, 3) + vec2(1, 1)).xyz;","else if (uv.x < 3.0*size && uv.y < 4.0*size)","diffuse = texture2D( tiles[11], uv * 4.0 - vec2(3, 4) + vec2(1, 1)).xyz;","else if (uv.x < 4.0*size && uv.y < 1.0*size)","diffuse = texture2D( tiles[12], uv * 4.0 - vec2(4, 1) + vec2(1, 1)).xyz;","else if (uv.x < 4.0*size && uv.y < 2.0*size)","diffuse = texture2D( tiles[13], uv * 4.0 - vec2(4, 2) + vec2(1, 1)).xyz;","else if (uv.x < 4.0*size && uv.y < 3.0*size)","diffuse = texture2D( tiles[14], uv * 4.0 - vec2(4, 3) + vec2(1, 1)).xyz;","else","diffuse = texture2D( tiles[15], uv * 4.0 - vec2(4, 4) + vec2(1, 1)).xyz;","float phong      = max(0.0, pow(dot( vNormal, normalize(vec3( -0.3, 0.4, 0.7))), 0.6))*0.4 + 0.65;","float specular   = max(0.0, pow(dot( vNormal, normalize(vec3( -0.3, 0.4, 0.7)) ), 60.0));","float atmosphere = pow(1.0 - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) ), 2.0) * 0.7;","gl_FragColor     = vec4( phong * diffuse + atmosphere + specular * 0.1, opacity );","}"].join("\n")},atmosphere:{uniforms:{bgColor:{type:"v3",value:null}},vertexShader:["varying vec3 vNormal;","void main() {","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 bgColor;","varying vec3 vNormal;","void main() {","float intensity = max(0.0, -0.05 + pow( -dot( vNormal, vec3( 0, 0, 1.0 ) ) + 0.5, 5.0 ));","gl_FragColor = vec4(vec3( 1.0, 1.0, 1.0) * intensity + bgColor * (1.0-intensity), 1.0 );","}"].join("\n")}},i.prototype.start=function(){var t,e=this;return this.myIsRunning?void 0:(this.myIsRunning=!0,this.myRenderer.domElement.style.display="inline",t=function(){return e.myIsRunning?(e.render(),requestAnimationFrame(t)):void 0},t())},i.prototype.stop=function(){return this.myIsRunning=!1,HG.deactivateAllHivents(),this.myRenderer.domElement.style.display="none"},i.prototype.isRunning=function(){return this.myIsRunning},i.prototype.getCanvas=function(){return this.myRenderer.domElement},i.prototype.center=function(t){return this.myTargetCameraPos.x=t.x,this.myTargetCameraPos.y=t.y},i.prototype.initWindowGeometry=function(){return this.myWidth=this.inContainer.parentNode.offsetWidth,this.myHeight=this.inContainer.parentNode.offsetHeight,this.myCanvasOffsetX=this.inContainer.parentNode.offsetLeft,this.myCanvasOffsetY=this.inContainer.parentNode.offsetTop},i.prototype.initGlobe=function(){var t,e,n,i,a,s,h;return i=function(t,e,n,r,o){var a;return n===l?{textures:null,loadedTextureCount:0,opacity:1,x:4*r,y:4*o,z:n,minLatLong:{x:t.x,y:t.y},maxLatLong:{x:t.x+e,y:t.y+e},children:null}:(a={textures:null,loadedTextureCount:0,opacity:1,x:4*r,y:4*o,z:n,minLatLong:{x:t.x,y:t.y},maxLatLong:{x:t.x+e,y:t.y+e},children:[]},a.children.push(i({x:t.x,y:t.y+.5*e},.5*e,n+1,2*r,2*o)),a.children.push(i({x:t.x+.5*e,y:t.y+.5*e},.5*e,n+1,2*r+1,2*o)),a.children.push(i({x:t.x,y:t.y},.5*e,n+1,2*r,2*o+1)),a.children.push(i({x:t.x+.5*e,y:t.y},.5*e,n+1,2*r+1,2*o+1)),a)},this.myCamera=new THREE.PerspectiveCamera(this.myCurrentFOV,this.myWidth/this.myHeight,1,1e4),this.myCamera.position.z=o,this.mySceneGlobe=new THREE.Scene,this.mySceneAtmosphere=new THREE.Scene,e=new THREE.SphereGeometry(c,64,32),s=d.earth,this.myGlobeUniforms=THREE.UniformsUtils.clone(s.uniforms),this.myGlobeTextures=i({x:0,y:0},1,2,0,0),a=new THREE.ShaderMaterial({vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,uniforms:this.myGlobeUniforms,transparent:!0}),n=new THREE.Mesh(e,a),n.matrixAutoUpdate=!1,this.mySceneGlobe.add(n),s=d.atmosphere,h=THREE.UniformsUtils.clone(s.uniforms),h.bgColor.value=new THREE.Vector3(r.r,r.g,r.b),a=new THREE.ShaderMaterial({uniforms:h,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}),t=new THREE.Mesh(e,a),t.scale.x=t.scale.y=t.scale.z=1.5,t.flipSided=!0,t.matrixAutoUpdate=!1,t.updateMatrix(),this.mySceneAtmosphere.add(t)},i.prototype.initRenderer=function(){return this.myRenderer=new THREE.WebGLRenderer({antialias:!0}),this.myRenderer.autoClear=!1,this.myRenderer.setClearColor(r,1),this.myRenderer.setSize(this.myWidth,this.myHeight),this.myRenderer.domElement.style.position="absolute",this.inContainer.appendChild(this.myRenderer.domElement)},i.prototype.initEventHandling=function(){var t=this;return this.myRenderer.domElement.addEventListener("mousedown",this.onMouseDown,!1),this.myRenderer.domElement.addEventListener("mousemove",this.onMouseMove,!1),this.myRenderer.domElement.addEventListener("mouseup",this.onMouseUp,!1),this.myRenderer.domElement.addEventListener("mousewheel",function(e){return e.preventDefault(),t.onMouseWheel(e.wheelDelta),!1},!1),this.myRenderer.domElement.addEventListener("DOMMouseScroll",function(e){return e.preventDefault(),t.onMouseWheel(30*-e.detail),!1},!1),document.addEventListener("keydown",this.onDocumentKeyDown,!1),window.addEventListener("resize",this.onWindowResize,!1)},i.prototype.initHivents=function(){var t=this;return this.inHiventHandler.onHiventsLoaded(function(e){var n,i,r,o;for(i=0,o=[];i<e.length;)n=new HG.HiventMarker3D(e[i],t,t.inContainer),t.mySceneGlobe.add(n),r=t.latLongToCart(new THREE.Vector2(e[i].getHivent().long,e[i].getHivent().lat)),n.translateOnAxis(new THREE.Vector3(1,0,0),r.x),n.translateOnAxis(new THREE.Vector3(0,1,0),r.y),n.translateOnAxis(new THREE.Vector3(0,0,1),r.z),o.push(i++);return o})},i.prototype.render=function(){var t,e,n,i,r,a,s,l,h,u,f;for(r={x:2*((this.myMousePos.x-this.myCanvasOffsetX)/this.myWidth)-1,y:2*((this.myMousePos.y-this.myCanvasOffsetY)/this.myHeight)-1},h=new THREE.Vector3(r.x,-r.y,.5),v.unprojectVector(h,this.myCamera),m.set(this.myCamera.position,h.sub(this.myCamera.position).normalize()),n=m.intersectObjects(this.mySceneGlobe.children),t=0;t<n.length;)n[t].object instanceof HG.HiventMarker3D&&(e=$.inArray(n[t].object,this.myLastIntersected),e>=0&&this.myLastIntersected.splice(e,1)),t++;for(t=0;t<this.myLastIntersected.length;)this.myLastIntersected[t].getHiventHandle().unMark(this.myLastIntersected[t],this.myMousePos),this.myLastIntersected[t].getHiventHandle().unLinkAll(this.myMousePos),t++;for(this.myLastIntersected=[],t=0;t<n.length;)n[t].object instanceof HG.HiventMarker3D&&(this.myLastIntersected.push(n[t].object),a={x:this.myMousePos.x-this.myCanvasOffsetX,y:this.myMousePos.y-this.myCanvasOffsetY},n[t].object.getHiventHandle().mark(n[t].object,a),n[t].object.getHiventHandle().linkAll(a)),t++;return this.myDragStartPos?(this.myMouseSpeed={x:.5*this.myMouseSpeed.x+.5*(this.myMousePos.x-this.myMousePosLastFrame.x),y:.5*this.myMouseSpeed.y+.5*(this.myMousePos.y-this.myMousePosLastFrame.y)},this.myMousePosLastFrame.x=this.myMousePos.x,this.myMousePosLastFrame.y=this.myMousePos.y,i=this.pixelToLatLong(r),i?(u=this.myDragStartPos.x-i.x,f=this.myDragStartPos.y-i.y,f>180?f-=360:-180>f&&(f+=360),this.myTargetCameraPos.y+=.5*u,this.myTargetCameraPos.x-=.5*f,this.clampCameraPos()):(this.myDragStartPos=null,container.style.cursor="auto")):0!==this.myMouseSpeed.x&&0!==this.myMouseSpeed.y&&(this.myTargetCameraPos.x-=.02*this.myMouseSpeed.x*this.myCurrentFOV,this.myTargetCameraPos.y+=.02*this.myMouseSpeed.y*this.myCurrentFOV,this.clampCameraPos(),this.myMouseSpeed={x:0,y:0}),this.myCurrentCameraPos.x=this.myCurrentCameraPos.x*this.mySpringiness+this.myTargetCameraPos.x*(1-this.mySpringiness),this.myCurrentCameraPos.y=this.myCurrentCameraPos.y*this.mySpringiness+this.myTargetCameraPos.y*(1-this.mySpringiness),s={x:this.myCurrentCameraPos.x*Math.PI/180,y:this.myCurrentCameraPos.y*Math.PI/180},this.myCamera.position.x=o*Math.sin(s.x+.5*Math.PI)*Math.cos(s.y),this.myCamera.position.y=o*Math.sin(s.y),this.myCamera.position.z=o*Math.cos(s.x+.5*Math.PI)*Math.cos(s.y),this.myCamera.lookAt(new THREE.Vector3(0,0,0)),this.myCurrentFOV!==this.myTargetFOV&&(l=.8,this.myCurrentFOV=this.myCurrentFOV*l+this.myTargetFOV*(1-l),this.myCamera.fov=this.myCurrentFOV,this.myCamera.updateProjectionMatrix(),this.myIsZooming=!0,Math.abs(this.myCurrentFOV-this.myTargetFOV)<.05&&(this.myCurrentFOV=this.myTargetFOV,this.myIsZooming=!1)),this.myRenderer.clear(),this.myRenderer.setFaceCulling(THREE.CullFaceBack),this.myRenderer.setDepthTest(!1),this.myRenderer.setBlending(THREE.AlphaBlending),this.renderTile(this.myGlobeTextures),this.myRenderer.setDepthTest(!0),this.myRenderer.setFaceCulling(THREE.CullFaceFront),this.myRenderer.render(this.mySceneAtmosphere,this.myCamera)},i.prototype.zoom=function(){return this.myTargetFOV=(l-this.myCurrentZoom)/(l-u)*(a-h)+h},i.prototype.onMouseDown=function(t){var e;return this.myIsRunning&&(t.preventDefault(),e={x:2*((t.clientX-this.myCanvasOffsetX)/this.myWidth)-1,y:2*((t.clientY-this.myCanvasOffsetY)/this.myHeight)-1},this.myDragStartPos=this.pixelToLatLong(e),this.myDragStartPos)?(this.inContainer.style.cursor="move",this.mySpringiness=.1,this.myTargetCameraPos.x=this.myCurrentCameraPos.x,this.myTargetCameraPos.y=this.myCurrentCameraPos.y,this.myMousePosLastFrame.x=this.myMousePos.x,this.myMousePosLastFrame.y=this.myMousePos.y):void 0},i.prototype.onMouseMove=function(t){return this.myIsRunning?this.myMousePos={x:t.clientX,y:t.clientY}:void 0},i.prototype.onMouseUp=function(t){var e,n,i;if(this.myIsRunning){if(t.preventDefault(),this.inContainer.style.cursor="auto",this.mySpringiness=.9,this.myDragStartPos=null,this.myDragStartCamera=null,0===this.myLastIntersected.length)return HG.deactivateAllHivents();for(e=0,i=[];e<this.myLastIntersected.length;)n={x:this.myMousePos.x-this.myCanvasOffsetX,y:this.myMousePos.y-this.myCanvasOffsetY},this.myLastIntersected[e].getHiventHandle().activeAll(n),i.push(e++);return i}},i.prototype.onMouseWheel=function(t){return this.myIsRunning&&(this.myCurrentZoom=Math.max(Math.min(this.myCurrentZoom+.005*t,l),u),this.zoom()),!1},i.prototype.onDocumentKeyDown=function(t){if(this.myIsRunning)switch(t.keyCode){case 38:return this.zoom(100),t.preventDefault();case 40:return this.zoom(-100),t.preventDefault()}},i.prototype.onWindowResize=function(){return this.myCamera.aspect=this.inContainer.parentNode.offsetWidth/this.inContainer.parentNode.offsetHeight,this.myCamera.updateProjectionMatrix(),this.myRenderer.setSize(this.inContainer.parentNode.offsetWidth,this.inContainer.parentNode.offsetHeight),this.initWindowGeometry()},i.prototype.clampCameraPos=function(){return this.myTargetCameraPos.y>s&&(this.myTargetCameraPos.y=s),this.myTargetCameraPos.y<-s?this.myTargetCameraPos.y=-s:void 0},i.prototype.pixelToLatLong=function(t){var e,n;return n=new THREE.Vector3(t.x,-t.y,.5),v.unprojectVector(n,this.myCamera),m.set(this.myCamera.position,n.sub(this.myCamera.position).normalize()),e=m.intersectObjects(this.mySceneGlobe.children),e.length>0?this.cartToLatLong(e[0].point.clone().normalize()):null},i.prototype.latLongToCart=function(t){var e,n,i;return e=c*Math.cos(t.y*Math.PI/180)*Math.cos(-t.x*Math.PI/180),n=c*Math.sin(t.y*Math.PI/180),i=c*Math.cos(t.y*Math.PI/180)*Math.sin(-t.x*Math.PI/180),new THREE.Vector3(e,n,i)},i.prototype.latLongToPixel=function(t){var e;return e=this.latLongToCart(t),v.projectVector(e,this.myCamera),e},i.prototype.cartToLatLong=function(t){var e,n;return e=180*(Math.asin(t.y)/Math.PI),n=180*(-Math.atan(t.x/t.z)/Math.PI)-90,t.z>0&&(n+=180),new THREE.Vector2(e,n)},i.prototype.isTileVisible=function(t,e){var n,i,r,o,a,s,l,h,u,f;return this.isFrontFacingTile(t,e)?(h=this.normalizedMercatusToNormalizedLatLong(t),a=this.normalizedMercatusToNormalizedLatLong(e),n=this.latLongToPixel(this.unNormalizeLatLong({x:h.x,y:h.y})),i=this.latLongToPixel(this.unNormalizeLatLong({x:a.x,y:h.y})),r=this.latLongToPixel(this.unNormalizeLatLong({x:a.x,y:a.y})),o=this.latLongToPixel(this.unNormalizeLatLong({x:h.x,y:a.y})),u=Math.min(Math.min(Math.min(n.x,i.x),r.x),o.x),s=Math.max(Math.max(Math.max(n.x,i.x),r.x),o.x),f=Math.min(Math.min(Math.min(n.y,i.y),r.y),o.y),l=Math.max(Math.max(Math.max(n.y,i.y),r.y),o.y),!(u>1||f>1||-1>s||-1>l)):!1},i.prototype.isFrontFacingTile=function(t,e){var n,i,r,o,a,s=this;return a=function(t){var e;return e=Math.acos(Math.sin((t.y-.5)*Math.PI)*Math.sin(s.myCurrentCameraPos.y*Math.PI/180)+Math.cos((t.y-.5)*Math.PI)*Math.cos(s.myCurrentCameraPos.y*Math.PI/180)*Math.cos(2*-(t.x-.5)*Math.PI+s.myCurrentCameraPos.x*Math.PI/180)),.5*Math.PI>e},n={x:t.x,y:t.y},i={x:e.x,y:t.y},r={x:e.x,y:e.y},o={x:t.x,y:e.y},a(n)||a(i)||a(r)||a(o)},i.prototype.tileChildrenLoaded=function(t){var e,n;for(e=0,n=t.children.length;n>e;){if(t.children[e].loadedTextureCount<16)return!1;e++}return!0},i.prototype.tileLoad=function(t){var e,n,i,r,o,a,s;for(t.textures=[],e=0,s=[];4>e;){for(n=0;4>n;)o=t.x+e,a=t.y+(3-n),i=y+t.z+"/"+o+"/"+a+".png",r=THREE.ImageUtils.loadTexture(i,new THREE.UVMapping,function(){return t.loadedTextureCount++}),t.textures.push(r),++n;s.push(++e)}return s},i.prototype.tileLoadChildren=function(t){var e,n,i;for(e=0,n=t.children.length,i=[];n>e;)null==t.children[e].textures&&this.tileLoad(t.children[e]),i.push(e++);return i},i.prototype.renderTile=function(t){var e,n;if(this.isTileVisible(t.minLatLong,t.maxLatLong)){if(t.z<this.myCurrentZoom-.5&&null!=t.children){if(this.tileChildrenLoaded(t)){for(e=0,n=t.children.length;n>e;)this.renderTile(t.children[e]),e++;if(t.opacity<.05)return t.opacity=0,void 0;this.myIsZooming||(t.opacity=.9*t.opacity)}this.myIsZooming||this.tileLoadChildren(t)}else t.opacity=1;return null==t.textures&&this.tileLoad(t),this.myGlobeUniforms.tiles.value=t.textures,this.myGlobeUniforms.opacity.value=t.opacity,this.myGlobeUniforms.minUV.value=t.minLatLong,this.myGlobeUniforms.maxUV.value=t.maxLatLong,this.myRenderer.render(this.mySceneGlobe,this.myCamera)}},i.prototype.normalizedLatLongToNormalizedMercatus=function(t){return 0===t.y?new THREE.Vector2(t.x,0):1===t.y?new THREE.Vector2(t.x,1):new THREE.Vector2(t.x,Math.log(Math.tan(.5*t.y*Math.PI))/(2*Math.PI)+.5)},i.prototype.normalizedMercatusToNormalizedLatLong=function(t){return 0===t.y?new THREE.Vector2(t.x,0):1===t.y?new THREE.Vector2(t.x,1):new THREE.Vector2(t.x,2/Math.PI*Math.atan(Math.exp(2*Math.PI*(t.y-.5))))},i.prototype.normalizeLatLong=function(t){return new THREE.Vector2(t.x/360+.5,t.y/180+.5)},i.prototype.unNormalizeLatLong=function(t){return new THREE.Vector2(360*t.x-180,180*t.y-90)},i}(HG.Display)}.call(this);var HG=HG||{};HG.Histrip=function(t,e){return this.coords=t,this.category=e,this};var HG=HG||{};HG.HistripHandle=function(t){var e=!1,n=[],i=[];return this.getHistrip=function(){return t},this.hover=function(){if(!e){e=!0;for(var t=0;t<n.length;t++)n[t]()}},this.unHover=function(){if(e){e=!1;for(var t=0;t<i.length;t++)i[t]()}},this.onHover=function(t){t&&"function"==typeof t&&n.push(t)},this.onUnHover=function(t){t&&"function"==typeof t&&i.push(t)},this};var HG=HG||{};HG.HistripHandler=function(){this.create=function(){$.getJSON("data/histrips.json",function(i){for(var r=0;r<i.length;r++){var o=new HG.Histrip(i[r].coords,i[r].category);t.push(new HG.HistripHandle(o))}e=!0;for(var r=0;r<n.length;r++)n[r](t)})},this.getAllHistripHandles=function(){return t},this.onHistripsLoaded=function(i){i&&"function"==typeof i&&(e?i(t):n.push(i))};var t=[],e=!1,n=[];return this.create(),this};var HG=HG||{},HG=HG||{};HG.Hivent=function(t,e,n,i,r,o,a,s){return this.name=t,this.category=e,this.date=n,this.displayDate=i,this.long=r,this.lat=o,this.description=a,this.parties=s,this};var HG=HG||{};HG.activeHivents=[],HG.HiventHandle=function(t){var e=!1,n=!1,i=!1,r=!1,o=[],a=[],s=[],l=[],h=[],u=[],f=[],c=[],f=[];return this.getHivent=function(){return t},this.activeAll=function(t){e=!0,HG.activeHivents.push(this);for(var n=0;n<o.length;n++)for(var i=0;i<o[n][1].length;i++)o[n][1][i](t)},this.active=function(t,n){e=!0,HG.activeHivents.push(this);for(var i=0;i<o.length;i++)if(o[i][0]==t){for(var r=0;r<o[i][1].length;r++)o[i][1][r](n);break}},this.inActiveAll=function(t){e=!1;var n=$.inArray(this,HG.activeHivents);n>=0&&delete HG.activeHivents[n];for(var i=0;i<a.length;i++)for(var r=0;r<a[i][1].length;r++)a[i][1][r](t)},this.inActive=function(t,n){e=!1;var i=$.inArray(this,HG.activeHivents);i>=0&&delete HG.activeHivents[i];for(var r=0;r<a.length;r++)if(a[r][0]==t){for(var o=0;o<a[r][1].length;o++)a[r][1][o](n);break}},this.toggleActiveAll=function(t){e=!e,e?this.activeAll(t):this.inActiveAll(t)},this.toggleActive=function(t,n){e=!e,e?this.active(t,n):this.inActive(t,n)},this.markAll=function(t){if(!n){n=!0;for(var e=0;e<s.length;e++)for(var i=0;i<s[e][1].length;i++)s[e][1][i](t)}},this.mark=function(t,e){if(!n){n=!0;for(var i=0;i<s.length;i++)if(s[i][0]==t){for(var r=0;r<s[i][1].length;r++)s[i][1][r](e);break}}},this.unMarkAll=function(t){if(n){n=!1;for(var e=0;e<l.length;e++)for(var i=0;i<l[e][1].length;i++)l[e][1][i](t)}},this.unMark=function(t,e){if(n){n=!1;for(var i=0;i<l.length;i++)if(l[i][0]==t){for(var r=0;r<l[i][1].length;r++)l[i][1][r](e);break}}},this.linkAll=function(t){if(!i){i=!0;for(var e=0;e<h.length;e++)for(var n=0;n<h[e][1].length;n++)h[e][1][n](t)}},this.link=function(t,e){if(!i){i=!0;for(var n=0;n<h.length;n++)if(h[n][0]==t){for(var r=0;r<h[n][1].length;r++)h[n][1][r](e);break}}},this.unLinkAll=function(t,e){if(i){i=!1;for(var n=0;n<u.length;n++)for(var r=0;r<u[n][1].length;r++)u[n][1][r](e)}},this.unLink=function(t){if(i){i=!1;for(var e=0;e<u.length;e++)if(u[e][0]==obj){for(var n=0;n<u[e][1].length;n++)u[e][1][n](t);break}}},this.focusAll=function(t){r=!0;for(var e=0;e<c.length;e++)for(var n=0;n<c[e][1].length;n++)c[e][1][n](t)},this.focus=function(t,e){r=!0;for(var n=0;n<c.length;n++)if(c[n][0]==t){for(var i=0;i<c[n][1].length;i++)c[n][1][i](e);break}},this.unFocusAll=function(t){r=!1;for(var e=0;e<f.length;e++)for(var n=0;n<f[e][1].length;n++)f[e][1][n](t)},this.unFocus=function(t,e){r=!1;for(var n=0;n<f.length;n++)if(f[n][0]==t){for(var i=0;i<f[n][1].length;i++)f[n][1][i](e);break}},this.onActive=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<o.length;n++)if(o[n][0]==t)return o[n][1].push(e),void 0;o.push([t,[e]])}},this.onInActive=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<a.length;n++)if(a[n][0]==t)return a[n][1].push(e),void 0;a.push([t,[e]])}},this.onMark=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<s.length;n++)if(s[n][0]==t)return s[n][1].push(e),void 0;s.push([t,[e]])}},this.onUnMark=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<l.length;n++)if(l[n][0]==t)return l[n][1].push(e),void 0;l.push([t,[e]])}},this.onLink=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<h.length;n++)if(h[n][0]==t)return h[n][1].push(e),void 0;
h.push([t,[e]])}},this.onUnLink=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<u.length;n++)if(u[n][0]==t)return u[n][1].push(e),void 0;u.push([t,[e]])}},this.onFocus=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<c.length;n++)if(c[n][0]==t)return c[n][1].push(e),void 0;c.push([t,[e]])}},this.onUnFocus=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<f.length;n++)if(f[n][0]==t)return f[n][1].push(e),void 0;f.push([t,[e]])}},this},HG.deactivateAllHivents=function(){for(var t=0;t<HG.activeHivents.length;t++)HG.activeHivents[t]&&HG.activeHivents[t].inActiveAll({x:0,y:0});HG.activeHivents=[]};var HG=HG||{};HG.HiventHandler=function(){function t(){$.getJSON("data/hivents.json",function(t){for(var r=0;r<t.length;r++){var o=new HG.Hivent(t[r].name,t[r].category,t[r].date,t[r].displayDate,t[r].long,t[r].lat,t[r].description,t[r].parties);e.push(new HG.HiventHandle(o))}n=!0;for(var r=0;r<i.length;r++)i[r](e)})}var e=[],n=!1,i=[];return this.getAllHiventHandles=function(){return e},this.onHiventsLoaded=function(t){t&&"function"==typeof t&&(n?t(e):i.push(t))},t(),this};var HG=HG||{};HG.hiventInfoCount=0,HG.HiventMarker=function(t,e){function n(){i=document.createElement("div"),i.class="btn",i.id="hiventInfo_"+HG.hiventInfoCount,i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.visibility="hidden",i.style.pointerEvents="none",e&&e.appendChild(i);var n=t.getHivent();$(i).tooltip({title:n.name,placement:"top"});var r='<p align="right">'+n.displayDate+"</p>"+n.description;$(i).popover({title:n.name,placement:"top",html:"true",content:r}),HG.hiventInfoCount++}var i,r=this;return this.getHiventHandle=function(){return t},this.showHiventName=function(t){i.style.left=t.x+"px",i.style.top=t.y+"px",$(i).tooltip("show")},this.hideHiventName=function(){$(i).tooltip("hide")},this.showHiventInfo=function(t){i.style.left=t.x+"px",i.style.top=t.y+"px",$(i).popover("show"),$(i).tooltip("hide")},this.hideHiventInfo=function(){$(i).popover("hide")},this.enableShowName=function(){t.onMark(r,this.showHiventName),t.onUnMark(r,this.hideHiventName)},this.enableShowInfo=function(){t.onActive(r,this.showHiventInfo),t.onInActive(r,this.hideHiventInfo)},n(),this};var HG=HG||{};HG.hiventMarker2DCount=0,HG.visibleMarkers2D=[],HG.HiventMarker2D=function(t,e,n){function i(){o=n.latLngToLayerPoint(r.getLatLng())}HG.HiventMarker.call(this,t,n.getPanes().popupPane),L.Marker.call(this,[t.getHivent().lat,t.getHivent().long]),this.addTo(n);var r=this,o=new L.Point(0,0);i();var a=40;return this.onMouseOver=function(){var t={x:o.x,y:o.y-a};r.getHiventHandle().mark(r,t),r.getHiventHandle().linkAll(t)},this.onMouseOut=function(){var t={x:o.x,y:o.y-a};r.getHiventHandle().unMark(r,t),r.getHiventHandle().unLinkAll(t)},this.onclick=function(){var t={x:o.x,y:o.y-a};r.getHiventHandle().toggleActive(r,t)},this.on("mouseover",r.onMouseOver),this.on("mouseout",r.onMouseOut),this.on("click",r.onclick),n.on("zoomend",i),n.on("dragend",i),n.on("viewreset",i),n.on("zoomstart",this.hideHiventInfo),HG.visibleMarkers2D.push(this),this.getHiventHandle().onMark(r,function(){}),this.getHiventHandle().onUnMark(r,function(){}),this.getHiventHandle().onLink(r,function(){}),this.getHiventHandle().onUnLink(r,function(){}),this.getHiventHandle().onFocus(r,function(){e.isRunning()&&e.focus(r.getHiventHandle().getHivent())}),this.enableShowName(),this.enableShowInfo(),this},HG.HiventMarker2D.prototype=Object.create(L.Marker.prototype);var HG=HG||{};HG.hiventMarkerGeometry=0,HG.HiventMarker3D=function(t,e,n){var i=this;0==HG.hiventMarkerGeometry&&(HG.hiventMarkerGeometry=new THREE.SphereGeometry(1,10,10));var r=new THREE.Vector3(.2,.2,.4),o=new THREE.Vector3(1,.5,0),a={hivent:{uniforms:{color:{type:"v3",value:null}},vertexShader:["varying vec3 vNormal;","void main() {","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4(color, 1.0);","}"].join("\n")}},s=a.hivent,l=THREE.UniformsUtils.clone(s.uniforms);l.color.value=r;var h=new THREE.ShaderMaterial({vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,uniforms:l});return HG.HiventMarker.call(this,t,n),THREE.Mesh.call(this,HG.hiventMarkerGeometry,h),this.getHiventHandle().onFocus(i,function(){e.isRunning()&&e.focus(i.getHiventHandle().getHivent())}),this.getHiventHandle().onMark(i,function(){l.color.value=o}),this.getHiventHandle().onUnMark(i,function(){l.color.value=r}),this.getHiventHandle().onLink(i,function(){l.color.value=o}),this.getHiventHandle().onUnLink(i,function(){l.color.value=r}),this.enableShowName(),this.enableShowInfo(),this},HG.HiventMarker3D.prototype=Object.create(THREE.Mesh.prototype);var HG=HG||{};HG.hiventMarkerTimelineCount=0,HG.visibleMarkers2D=[],HG.HiventMarkerTimeline=function(t,e,n){HG.HiventMarker.call(this,t,e);var i,r="#253563",o="#ff8800",a=this,s={x:n,y:Math.floor(.85*$(e.parentNode).innerHeight())},l=4;return i=document.createElement("div"),i.id="hiventMarkerTimeline_"+HG.hiventMarker2DCount,i.style.position="absolute",i.style.width=2*l+"px",i.style.height=2*l+"px",i.style.borderRadius=l+"px",i.style.backgroundColor=r,i.style.left=s.x+"px",i.style.top=s.y+"px",e.appendChild(i),i.onmouseover=function(){var t={x:s.x+l,y:s.y+.6*l};a.getHiventHandle().mark(a,t),a.getHiventHandle().linkAll(t)},i.onmouseout=function(){var t={x:s.x+l,y:s.y+.6*l};a.getHiventHandle().unMark(a,t),a.getHiventHandle().unLinkAll(t)},i.onclick=function(){var t={x:s.x+l,y:s.y+.6*l};a.getHiventHandle().focusAll(t)},HG.hiventMarkerTimelineCount++,this.getHiventHandle().onMark(a,function(){i.style.backgroundColor=o}),this.getHiventHandle().onUnMark(a,function(){i.style.backgroundColor=r}),this.getHiventHandle().onLink(a,function(){i.style.backgroundColor=o}),this.getHiventHandle().onUnLink(a,function(){i.style.backgroundColor=r}),this.enableShowName(),this.getPosition=function(){return s},this.setPosition=function(t){s.x=t,i.style.left=s.x+"px"},this.hide=function(){i.style.display="none"},this.show=function(){i.style.display="block"},this};var HG=HG||{};HG.VideoPlayer=function(t){function e(t){t.target.playVideo()}function n(){i=new YT.Player(r,{events:{onReady:e}})}var i,r=t;return this.stopVideo=function(){i.pauseVideo()},n(),this};var BrowserDetect={init:function(){this.canvasSupported=!!window.CanvasRenderingContext2D,this.webglContextSupported=!!window.WebGLRenderingContext,this.webglRenderingSupported=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(t){return!1}}();var t=this.searchString(this.dataBrowser)||{identity:"unknown"};this.browser=t.identity,this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.platformInfo=this.searchString(this.dataPlatform)||this.dataPlatform.unknown,this.platform=this.platformInfo.identity;var e=this.urls[this.browser];if(e){if(e.platforms){var t=e.platforms[this.platform];t&&(e=t)}}else e=this.urls.unknown;this.urls=e},searchString:function(t){for(var e=0;e<t.length;e++){var n=t[e],i=n.string,r=n.prop;if(this.versionSearchString=n.versionSearch||n.identity,i){if(-1!=i.indexOf(n.subString))return n}else if(r)return n}},searchVersion:function(t){var e=t.indexOf(this.versionSearchString);if(-1!=e)return parseFloat(t.substring(e+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Internet Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataPlatform:[{string:navigator.platform,subString:"Win",identity:"Windows",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"},{url:"http://www.google.com/chrome/",name:"Google Chrome"}]},{string:navigator.platform,subString:"Mac",identity:"Mac",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"},{url:"http://www.google.com/chrome/",name:"Google Chrome"},{url:"http://www.webkit.org/",name:"WebKit Developer Builds"}]},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"}]},{string:navigator.platform,subString:"iPad",identity:"iPad",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"}]},{string:navigator.userAgent,subString:"Android",identity:"Android",browsers:[{url:"https://market.android.com/details?id=org.mozilla.firefox",name:"Mozilla Firefox"},{url:"https://market.android.com/details?id=com.opera.browser",name:"Opera Mobile"}]},{string:navigator.platform,subString:"Linux",identity:"Linux",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"},{url:"http://www.google.com/chrome/",name:"Google Chrome"},{url:"http://www.opera.com/browser/next/",name:"Opera Next"}]},{string:"unknown",subString:"unknown",identity:"unknown",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"},{url:"http://www.google.com/chrome/",name:"Google Chrome"},{url:"http://www.opera.com/browser/next/",name:"Opera Next"},{url:"http://www.webkit.org/",name:"WebKit Developer Builds"}]}],urls:{Chrome:{upgradeUrl:"http://www.google.com/support/chrome/bin/answer.py?answer=95346",troubleshootingUrl:"http://www.google.com/support/chrome/bin/answer.py?answer=1220892"},Firefox:{upgradeUrl:"http://www.mozilla.com/en-US/firefox/new/",troubleshootingUrl:"https://support.mozilla.com/en-US/kb/how-do-i-upgrade-my-graphics-drivers"},Opera:{platforms:{Android:{upgradeUrl:"https://market.android.com/details?id=com.opera.browser",troubleshootingUrl:"http://www.opera.com/support/"}},upgradeUrl:"http://www.opera.com/browser/next/",troubleshootingUrl:"http://www.opera.com/support/"},Android:{upgradeUrl:null,troubleshootingUrl:null},Safari:{platforms:{"iPhone/iPod":{upgradeUrl:"http://www.apple.com/ios/",troubleshootingUrl:"http://www.apple.com/support/iphone/"},iPad:{upgradeUrl:"http://www.apple.com/ios/",troubleshootingUrl:"http://www.apple.com/support/ipad/"},Mac:{upgradeUrl:"http://www.webkit.org/",troubleshootingUrl:"http://www.webkit.org/blog/919/webgl-draft-specification-now-available/"}},upgradeUrl:"http://www.webkit.org/",troubleshootingUrl:"http://www.webkit.org/blog/919/webgl-draft-specification-now-available/"},unknown:{upgradeUrl:null,troubleshootingUrl:null}}};