!function(){if(window.HG==null){window.HG={}}HG.Display=function(){function Display(){}Display.prototype.focus=function(hivent){return this.center({x:hivent.long,y:hivent.lat})};return Display}()}.call(this);var HG=HG||{};HG.Display2D=function(inContainer,inHiventHandler){HG.Display2D.MAX_ZOOM=1.5;HG.Display2D.MIN_ZOOM=.1;this.create=function(){initCanvas();initEventHandling();initHivents()};this.start=function(){if(!myIsRunning){myIsRunning=true;mapParent.style.display="block"}};this.stop=function(){myIsRunning=false;mapParent.style.display="none"};this.isRunning=function(){return myIsRunning};this.getCanvas=function(){return mapParent};this.center=function(longLat){myMap.panTo([longLat.y,longLat.x])};var mySelf=this;var myMap;var mapParent;var hiventMarkers=[];var myIsRunning=false;function initCanvas(){mapParent=document.createElement("div");mapParent.style.width=$(inContainer.parentNode).width()+"px";mapParent.style.height=$(inContainer.parentNode).height()+"px";inContainer.appendChild(mapParent);myMap=L.map(mapParent,{maxZoom:7,minZoom:1,zoomControl:false}).setView([51.505,10.09],4);myMap.attributionControl.setPrefix("");L.tileLayer("data/tiles/{z}/{x}/{y}.png").addTo(myMap);myIsRunning=true}function initEventHandling(){window.addEventListener("resize",onWindowResize,false)}function initHivents(){inHiventHandler.onHiventsLoaded(function(handles){for(var i=0;i<handles.length;i++){var marker=new HG.HiventMarker2D(handles[i],mySelf,myMap);hiventMarkers.push(marker)}});myMap.on("click",HG.deactivateAllHivents)}function onWindowResize(event){mapParent.style.width=$(inContainer.parentNode).width()+"px";mapParent.style.height=$(inContainer.parentNode).height()+"px"}HG.Display.call(this);this.create();return this};HG.Display2D.prototype=Object.create(HG.Display.prototype);!function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};if(window.HG==null){window.HG={}}HG.Display3D=function(_super){var BACKGROUND,CAMERA_DISTANCE,CAMERA_MAX_FOV,CAMERA_MAX_LONG,CAMERA_MAX_ZOOM,CAMERA_MIN_FOV,CAMERA_MIN_ZOOM,CAMERA_ZOOM_SPEED,EARTH_RADIUS,PROJECTOR,RAYCASTER,SHADERS,TILE_PATH;__extends(Display3D,_super);function Display3D(inContainer,inHiventHandler){this._onMouseWheel=__bind(this._onMouseWheel,this);this.onMouseUp=__bind(this.onMouseUp,this);this.onMouseMove=__bind(this.onMouseMove,this);this.onMouseDown=__bind(this.onMouseDown,this);this.inContainer=inContainer;this.inHiventHandler=inHiventHandler;this._initMembers();this._initWindowGeometry();this._initGlobe();this._initRenderer();this._initHivents();this._initEventHandling();this._zoom();this.center({x:10,y:50})}Display3D.prototype.start=function(){var animate,_this=this;if(!this._myIsRunning){this._myIsRunning=true;this._myRenderer.domElement.style.display="inline";animate=function(){if(_this._myIsRunning){_this._render();return requestAnimationFrame(animate)}};return animate()}};Display3D.prototype.stop=function(){this._myIsRunning=false;HG.deactivateAllHivents();return this._myRenderer.domElement.style.display="none"};Display3D.prototype.isRunning=function(){return this._myIsRunning};Display3D.prototype.getCanvas=function(){return this._myRenderer.domElement};Display3D.prototype.center=function(latLong){this._myTargetCameraPos.x=latLong.x;return this._myTargetCameraPos.y=latLong.y};Display3D.prototype._initMembers=function(){this._myWidth=null;this._myHeight=null;this._myCamera=null;this._myRenderer=null;this._mySceneGlobe=null;this._mySceneAtmosphere=null;this._myCanvasOffsetX=null;this._myCanvasOffsetY=null;this._myLastIntersected=[];this._myCurrentCameraPos={x:0,y:0};this._myTargetCameraPos={x:0,y:0};this._myMousePos={x:0,y:0};this._myMousePosLastFrame={x:0,y:0};this._myMouseSpeed={x:0,y:0};this._myDragStartPos=null;this._mySpringiness=.9;this._myCurrentFOV=0;this._myTargetFOV=0;this._myGlobeTextures=[];this._myGlobeUniforms=null;this._myIsRunning=false;this._myCurrentZoom=CAMERA_MIN_ZOOM;return this._myIsZooming=false};Display3D.prototype._initWindowGeometry=function(){this._myWidth=this.inContainer.parentNode.offsetWidth;this._myHeight=this.inContainer.parentNode.offsetHeight;this._myCanvasOffsetX=this.inContainer.parentNode.offsetLeft;return this._myCanvasOffsetY=this.inContainer.parentNode.offsetTop};Display3D.prototype._initGlobe=function(){var atmosphere,geometry,globe,initTile,material,shader,uniforms,_this=this;initTile=function(minLatLong,size,zoom,x,y){var node;node={textures:null,loadedTextureCount:0,opacity:1,x:x*4,y:y*4,z:zoom,minLatLong:{x:minLatLong.x,y:minLatLong.y},maxLatLong:{x:minLatLong.x+size,y:minLatLong.y+size},children:null};if(zoom!==CAMERA_MAX_ZOOM){node.children=[];node.children.push(initTile({x:minLatLong.x,y:minLatLong.y+size*.5},size*.5,zoom+1,x*2,y*2));node.children.push(initTile({x:minLatLong.x+size*.5,y:minLatLong.y+size*.5},size*.5,zoom+1,x*2+1,y*2));node.children.push(initTile({x:minLatLong.x,y:minLatLong.y},size*.5,zoom+1,x*2,y*2+1));node.children.push(initTile({x:minLatLong.x+size*.5,y:minLatLong.y},size*.5,zoom+1,x*2+1,y*2+1))}return node};geometry=new THREE.SphereGeometry(EARTH_RADIUS,64,32);shader=SHADERS.earth;this._myCamera=new THREE.PerspectiveCamera(this._myCurrentFOV,this._myWidth/this._myHeight,1,1e4);this._myCamera.position.z=CAMERA_DISTANCE;this._mySceneGlobe=new THREE.Scene;this._mySceneAtmosphere=new THREE.Scene;this._myGlobeUniforms=THREE.UniformsUtils.clone(shader.uniforms);this._myGlobeTextures=initTile({x:0,y:0},1,2,0,0);material=new THREE.ShaderMaterial({vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader,uniforms:this._myGlobeUniforms,transparent:true});globe=new THREE.Mesh(geometry,material);globe.matrixAutoUpdate=false;this._mySceneGlobe.add(globe);shader=SHADERS.atmosphere;uniforms=THREE.UniformsUtils.clone(shader.uniforms);uniforms.bgColor.value=new THREE.Vector3(BACKGROUND.r,BACKGROUND.g,BACKGROUND.b);material=new THREE.ShaderMaterial({uniforms:uniforms,vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader});atmosphere=new THREE.Mesh(geometry,material);atmosphere.scale.x=atmosphere.scale.y=atmosphere.scale.z=1.5;atmosphere.flipSided=true;atmosphere.matrixAutoUpdate=false;atmosphere.updateMatrix();return this._mySceneAtmosphere.add(atmosphere)};Display3D.prototype._initRenderer=function(){this._myRenderer=new THREE.WebGLRenderer({antialias:true});this._myRenderer.autoClear=false;this._myRenderer.setClearColor(BACKGROUND,1);this._myRenderer.setSize(this._myWidth,this._myHeight);this._myRenderer.domElement.style.position="absolute";return this.inContainer.appendChild(this._myRenderer.domElement)};Display3D.prototype._initEventHandling=function(){var _this=this;this._myRenderer.domElement.addEventListener("mousedown",this.onMouseDown,false);this._myRenderer.domElement.addEventListener("mousemove",this.onMouseMove,false);this._myRenderer.domElement.addEventListener("mousewheel",function(event){event.preventDefault();_this._onMouseWheel(event.wheelDelta);return false},false);this._myRenderer.domElement.addEventListener("DOMMouseScroll",function(event){event.preventDefault();_this._onMouseWheel(-event.detail*30);return false},false);window.addEventListener("resize",this._onWindowResize,false);return window.addEventListener("mouseup",this.onMouseUp,false)};Display3D.prototype._initHivents=function(){var _this=this;return this.inHiventHandler.onHiventsLoaded(function(handles){var handle,hivent,position,_i,_len,_results;_results=[];for(_i=0,_len=handles.length;_i<_len;_i++){handle=handles[_i];hivent=new HG.HiventMarker3D(handle,_this,_this.inContainer);position=_this._latLongToCart({x:handle.getHivent().long,y:handle.getHivent().lat});hivent.translateOnAxis(new THREE.Vector3(1,0,0),position.x);hivent.translateOnAxis(new THREE.Vector3(0,1,0),position.y);hivent.translateOnAxis(new THREE.Vector3(0,0,1),position.z);_results.push(_this._mySceneGlobe.add(hivent))}return _results})};Display3D.prototype._render=function(){var index,intersect,intersects,latLongCurr,mouseRel,newIntersects,offset,pos,rotation,smoothness,vector,_i,_j,_k,_len,_len1,_len2,_ref;mouseRel={x:(this._myMousePos.x-this._myCanvasOffsetX)/this._myWidth*2-1,y:(this._myMousePos.y-this._myCanvasOffsetY)/this._myHeight*2-1};vector=new THREE.Vector3(mouseRel.x,-mouseRel.y,.5);PROJECTOR.unprojectVector(vector,this._myCamera);RAYCASTER.set(this._myCamera.position,vector.sub(this._myCamera.position).normalize());intersects=RAYCASTER.intersectObjects(this._mySceneGlobe.children);newIntersects=[];for(_i=0,_len=intersects.length;_i<_len;_i++){intersect=intersects[_i];if(intersect.object instanceof HG.HiventMarker3D){index=$.inArray(intersect.object,this._myLastIntersected);if(index>=0){this._myLastIntersected.splice(index,1)}}}_ref=this._myLastIntersected;for(_j=0,_len1=_ref.length;_j<_len1;_j++){intersect=_ref[_j];intersect.getHiventHandle().unMark(intersect);intersect.getHiventHandle().unLinkAll()}this._myLastIntersected=[];for(_k=0,_len2=intersects.length;_k<_len2;_k++){intersect=intersects[_k];if(intersect.object instanceof HG.HiventMarker3D){this._myLastIntersected.push(intersect.object);pos={x:this._myMousePos.x-this._myCanvasOffsetX,y:this._myMousePos.y-this._myCanvasOffsetY};intersect.object.getHiventHandle().mark(intersect.object,pos);intersect.object.getHiventHandle().linkAll(pos)}}if(this._myDragStartPos){this._myMouseSpeed={x:.5*this._myMouseSpeed.x+.5*(this._myMousePos.x-this._myMousePosLastFrame.x),y:.5*this._myMouseSpeed.y+.5*(this._myMousePos.y-this._myMousePosLastFrame.y)};this._myMousePosLastFrame={x:this._myMousePos.x,y:this._myMousePos.y};latLongCurr=this._pixelToLatLong(mouseRel);if(latLongCurr){offset={x:this._myDragStartPos.x-latLongCurr.x,y:this._myDragStartPos.y-latLongCurr.y};if(offset.y>180){offset.y-=360}else if(offset.y<-180){yOffset+=360}this._myTargetCameraPos.y+=.5*offset.x;this._myTargetCameraPos.x-=.5*offset.y;this._clampCameraPos()}else{this._myDragStartPos=null;container.style.cursor="auto"}}else if(this._myMouseSpeed.x!==0&&this._myMouseSpeed.y!==0){this._myTargetCameraPos.x-=this._myMouseSpeed.x*this._myCurrentFOV*.02;this._myTargetCameraPos.y+=this._myMouseSpeed.y*this._myCurrentFOV*.02;this._clampCameraPos();this._myMouseSpeed={x:0,y:0}}this._myCurrentCameraPos={x:this._myCurrentCameraPos.x*this._mySpringiness+this._myTargetCameraPos.x*(1-this._mySpringiness),y:this._myCurrentCameraPos.y*this._mySpringiness+this._myTargetCameraPos.y*(1-this._mySpringiness)};rotation={x:this._myCurrentCameraPos.x*Math.PI/180,y:this._myCurrentCameraPos.y*Math.PI/180};this._myCamera.position={x:CAMERA_DISTANCE*Math.sin(rotation.x+Math.PI*.5)*Math.cos(rotation.y),y:CAMERA_DISTANCE*Math.sin(rotation.y),z:CAMERA_DISTANCE*Math.cos(rotation.x+Math.PI*.5)*Math.cos(rotation.y)};this._myCamera.lookAt(new THREE.Vector3(0,0,0));if(this._myCurrentFOV!==this._myTargetFOV){smoothness=.8;this._myCurrentFOV=this._myCurrentFOV*smoothness+this._myTargetFOV*(1-smoothness);this._myCamera.fov=this._myCurrentFOV;this._myCamera.updateProjectionMatrix();this._myIsZooming=true;if(Math.abs(this._myCurrentFOV-this._myTargetFOV)<.05){this._myCurrentFOV=this._myTargetFOV;this._myIsZooming=false}}this._myRenderer.clear();this._myRenderer.setFaceCulling(THREE.CullFaceBack);this._myRenderer.setDepthTest(false);this._myRenderer.setBlending(THREE.AlphaBlending);this._renderTile(this._myGlobeTextures);this._myRenderer.setDepthTest(true);this._myRenderer.setFaceCulling(THREE.CullFaceFront);return this._myRenderer.render(this._mySceneAtmosphere,this._myCamera)};Display3D.prototype._zoom=function(){return this._myTargetFOV=(CAMERA_MAX_ZOOM-this._myCurrentZoom)/(CAMERA_MAX_ZOOM-CAMERA_MIN_ZOOM)*(CAMERA_MAX_FOV-CAMERA_MIN_FOV)+CAMERA_MIN_FOV};Display3D.prototype.onMouseDown=function(event){var clickMouse;if(this._myIsRunning){event.preventDefault();clickMouse={x:(event.clientX-this._myCanvasOffsetX)/this._myWidth*2-1,y:(event.clientY-this._myCanvasOffsetY)/this._myHeight*2-1};this._myDragStartPos=this._pixelToLatLong(clickMouse);if(this._myDragStartPos){this.inContainer.style.cursor="move";this._mySpringiness=.1;this._myTargetCameraPos.x=this._myCurrentCameraPos.x;this._myTargetCameraPos.y=this._myCurrentCameraPos.y;this._myMousePosLastFrame.x=this._myMousePos.x;return this._myMousePosLastFrame.y=this._myMousePos.y}}};Display3D.prototype.onMouseMove=function(event){if(this._myIsRunning){return this._myMousePos={x:event.clientX,y:event.clientY}}};Display3D.prototype.onMouseUp=function(event){var intersect,pos,_i,_len,_ref;if(this._myIsRunning){event.preventDefault();this.inContainer.style.cursor="auto";this._mySpringiness=.9;this._myDragStartPos=null;this._myDragStartCamera=null;if(this._myLastIntersected.length===0){HG.deactivateAllHivents()}else{_ref=this._myLastIntersected;for(_i=0,_len=_ref.length;_i<_len;_i++){intersect=_ref[_i];pos={x:this._myMousePos.x-this._myCanvasOffsetX,y:this._myMousePos.y-this._myCanvasOffsetY};intersect.getHiventHandle().activeAll(pos)}}return true}};Display3D.prototype._onMouseWheel=function(delta){if(this._myIsRunning){this._myCurrentZoom=Math.max(Math.min(this._myCurrentZoom+delta*.005,CAMERA_MAX_ZOOM),CAMERA_MIN_ZOOM);this._zoom()}return true};Display3D.prototype._onWindowResize=function(event){this._myCamera.aspect=this.inContainer.parentNode.offsetWidth/this.inContainer.parentNode.offsetHeight;this._myCamera.updateProjectionMatrix();this._myRenderer.setSize(this.inContainer.parentNode.offsetWidth,this.inContainer.parentNode.offsetHeight);return this._initWindowGeometry()};Display3D.prototype._clampCameraPos=function(){if(this._myTargetCameraPos.y>CAMERA_MAX_LONG){this._myTargetCameraPos.y=CAMERA_MAX_LONG}if(this._myTargetCameraPos.y<-CAMERA_MAX_LONG){return this._myTargetCameraPos.y=-CAMERA_MAX_LONG}};Display3D.prototype._isTileVisible=function(minNormalizedLatLong,maxNormalizedLatLong){var a,b,c,d,max,maxX,maxY,min,minX,minY;if(this._isFrontFacingTile(minNormalizedLatLong,maxNormalizedLatLong)){min=this._normalizedMercatusToNormalizedLatLong(minNormalizedLatLong);max=this._normalizedMercatusToNormalizedLatLong(maxNormalizedLatLong);a=this._latLongToPixel(this._unNormalizeLatLong({x:min.x,y:min.y}));b=this._latLongToPixel(this._unNormalizeLatLong({x:max.x,y:min.y}));c=this._latLongToPixel(this._unNormalizeLatLong({x:max.x,y:max.y}));d=this._latLongToPixel(this._unNormalizeLatLong({x:min.x,y:max.y}));minX=Math.min(Math.min(Math.min(a.x,b.x),c.x),d.x);maxX=Math.max(Math.max(Math.max(a.x,b.x),c.x),d.x);minY=Math.min(Math.min(Math.min(a.y,b.y),c.y),d.y);maxY=Math.max(Math.max(Math.max(a.y,b.y),c.y),d.y);return!(minX>1||minY>1||maxX<-1||maxY<-1)}return false};Display3D.prototype._isFrontFacingTile=function(minNormalizedLatLong,maxNormalizedLatLong){var a,b,c,d,isOnFrontSide,_this=this;isOnFrontSide=function(pos){var diff;diff=Math.acos(Math.sin((pos.y-.5)*Math.PI)*Math.sin(_this._myCurrentCameraPos.y*Math.PI/180)+Math.cos((pos.y-.5)*Math.PI)*Math.cos(_this._myCurrentCameraPos.y*Math.PI/180)*Math.cos(-(pos.x-.5)*2*Math.PI+_this._myCurrentCameraPos.x*Math.PI/180));return Math.PI*.5>diff};a={x:minNormalizedLatLong.x,y:minNormalizedLatLong.y};b={x:maxNormalizedLatLong.x,y:minNormalizedLatLong.y};c={x:maxNormalizedLatLong.x,y:maxNormalizedLatLong.y};d={x:minNormalizedLatLong.x,y:maxNormalizedLatLong.y};return isOnFrontSide(a)||isOnFrontSide(b)||isOnFrontSide(c)||isOnFrontSide(d)};Display3D.prototype._tileChildrenLoaded=function(tile){var child,_i,_len,_ref;_ref=tile.children;for(_i=0,_len=_ref.length;_i<_len;_i++){child=_ref[_i];if(child.loadedTextureCount<16){return false}}return true};Display3D.prototype._tileLoad=function(tile){var dx,dy,file,tex,x,y,_results;tile.textures=[];dx=0;_results=[];while(dx<4){dy=0;while(dy<4){x=tile.x+dx;y=tile.y+(3-dy);file=TILE_PATH+tile.z+"/"+x+"/"+y+".png";tex=THREE.ImageUtils.loadTexture(file,new THREE.UVMapping,function(){return tile.loadedTextureCount++});tile.textures.push(tex);++dy}_results.push(++dx)}return _results};Display3D.prototype._tileLoadChildren=function(tile){var child,_i,_len,_ref,_results;_ref=tile.children;_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){child=_ref[_i];if(child.textures==null){_results.push(this._tileLoad(child))}else{_results.push(void 0)}}return _results};Display3D.prototype._renderTile=function(tile){var child,_i,_len,_ref;if(this._isTileVisible(tile.minLatLong,tile.maxLatLong)){if(tile.z<this._myCurrentZoom-.5&&tile.children!=null){if(this._tileChildrenLoaded(tile)){if(tile.opacity!==1){_ref=tile.children;for(_i=0,_len=_ref.length;_i<_len;_i++){child=_ref[_i];this._renderTile(child)}}if(tile.opacity<.05){tile.opacity=0;return}if(!this._myIsZooming){tile.opacity=tile.opacity*.9}}if(!this._myIsZooming){this._tileLoadChildren(tile)}}else{tile.opacity=1}if(tile.textures==null){this._tileLoad(tile)}this._myGlobeUniforms.tiles.value=tile.textures;this._myGlobeUniforms.opacity.value=tile.opacity;this._myGlobeUniforms.minUV.value=tile.minLatLong;this._myGlobeUniforms.maxUV.value=tile.maxLatLong;return this._myRenderer.render(this._mySceneGlobe,this._myCamera)}};Display3D.prototype._pixelToLatLong=function(inPixel){var intersects,vector;vector=new THREE.Vector3(inPixel.x,-inPixel.y,.5);PROJECTOR.unprojectVector(vector,this._myCamera);RAYCASTER.set(this._myCamera.position,vector.sub(this._myCamera.position).normalize());intersects=RAYCASTER.intersectObjects(this._mySceneGlobe.children);if(intersects.length>0){return this._cartToLatLong(intersects[0].point.clone().normalize())}return null};Display3D.prototype._latLongToCart=function(latLong){var x,y,z;x=EARTH_RADIUS*Math.cos(latLong.y*Math.PI/180)*Math.cos(-latLong.x*Math.PI/180);y=EARTH_RADIUS*Math.sin(latLong.y*Math.PI/180);z=EARTH_RADIUS*Math.cos(latLong.y*Math.PI/180)*Math.sin(-latLong.x*Math.PI/180);return new THREE.Vector3(x,y,z)};Display3D.prototype._latLongToPixel=function(latLong){var pos;pos=this._latLongToCart(latLong);PROJECTOR.projectVector(pos,this._myCamera);return pos};Display3D.prototype._cartToLatLong=function(coordinates){var lat,long;lat=Math.asin(coordinates.y)/Math.PI*180;long=-Math.atan(coordinates.x/coordinates.z)/Math.PI*180-90;if(coordinates.z>0){long+=180}return new THREE.Vector2(lat,long)};Display3D.prototype._normalizedLatLongToNormalizedMercatus=function(latLong){if(latLong.y===0){return new THREE.Vector2(latLong.x,0)}if(latLong.y===1){return new THREE.Vector2(latLong.x,1)}return new THREE.Vector2(latLong.x,Math.log(Math.tan(latLong.y*.5*Math.PI))/(Math.PI*2)+.5)};Display3D.prototype._normalizedMercatusToNormalizedLatLong=function(mercatus){if(mercatus.y===0){return new THREE.Vector2(mercatus.x,0)}if(mercatus.y===1){return new THREE.Vector2(mercatus.x,1)}return new THREE.Vector2(mercatus.x,2/Math.PI*Math.atan(Math.exp(2*Math.PI*(mercatus.y-.5))))};Display3D.prototype._normalizeLatLong=function(latLong){return new THREE.Vector2(latLong.x/360+.5,latLong.y/180+.5)};Display3D.prototype._unNormalizeLatLong=function(normalizedLatLong){return new THREE.Vector2(normalizedLatLong.x*360-180,normalizedLatLong.y*180-90)};PROJECTOR=new THREE.Projector;RAYCASTER=new THREE.Raycaster;BACKGROUND=new THREE.Color(13421772);TILE_PATH="data/tiles/";EARTH_RADIUS=200;CAMERA_DISTANCE=500;CAMERA_MAX_ZOOM=7;CAMERA_MIN_ZOOM=3;CAMERA_MAX_FOV=60;CAMERA_MIN_FOV=4;CAMERA_MAX_LONG=80;CAMERA_ZOOM_SPEED=.1;SHADERS={earth:{uniforms:{tiles:{type:"tv",value:[]},opacity:{type:"f",value:0},minUV:{type:"v2",value:null},maxUV:{type:"v2",value:null}},vertexShader:"varying vec3 vNormal;\nvarying vec2 vTexcoord;\n\nfloat convertCoords(float lat) {\n  if (lat == 0.0) return 0.0;\n  if (lat == 1.0) return 1.0;\n  const float pi = 3.1415926535897932384626433832795;\n  return log(tan(lat*0.5 * pi)) / (pi * 2.0) + 0.5;\n}\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vNormal = normalize( normalMatrix * normal );\n  vTexcoord = vec2(uv.x, convertCoords(uv.y));\n}",fragmentShader:"uniform sampler2D tiles[16];\nuniform float opacity;\nuniform vec2 minUV;\nuniform vec2 maxUV;\nvarying vec3 vNormal;\nvarying vec2 vTexcoord;\n\nvoid main() {\n  \n  if (minUV.x > vTexcoord.x || maxUV.x < vTexcoord.x ||\n      minUV.y > vTexcoord.y || maxUV.y < vTexcoord.y)\n        discard;\n  \n  vec2 uv = (vTexcoord - minUV)/(maxUV - minUV);\n  vec3 diffuse = vec3(0);\n  float size = 0.25;\n  \n  if      (uv.x < 1.0*size && uv.y < 1.0*size)\n    diffuse = texture2D( tiles[ 0], uv * 4.0 - vec2(1, 1) + vec2(1, 1)).xyz;\n  else if (uv.x < 1.0*size && uv.y < 2.0*size)\n    diffuse = texture2D( tiles[ 1], uv * 4.0 - vec2(1, 2) + vec2(1, 1)).xyz;\n  else if (uv.x < 1.0*size && uv.y < 3.0*size)\n    diffuse = texture2D( tiles[ 2], uv * 4.0 - vec2(1, 3) + vec2(1, 1)).xyz;\n  else if (uv.x < 1.0*size && uv.y < 4.0*size)\n    diffuse = texture2D( tiles[ 3], uv * 4.0 - vec2(1, 4) + vec2(1, 1)).xyz;\n  else if (uv.x < 2.0*size && uv.y < 1.0*size)\n    diffuse = texture2D( tiles[ 4], uv * 4.0 - vec2(2, 1) + vec2(1, 1)).xyz;\n  else if (uv.x < 2.0*size && uv.y < 2.0*size)\n    diffuse = texture2D( tiles[ 5], uv * 4.0 - vec2(2, 2) + vec2(1, 1)).xyz;\n  else if (uv.x < 2.0*size && uv.y < 3.0*size)\n    diffuse = texture2D( tiles[ 6], uv * 4.0 - vec2(2, 3) + vec2(1, 1)).xyz;\n  else if (uv.x < 2.0*size && uv.y < 4.0*size)\n    diffuse = texture2D( tiles[ 7], uv * 4.0 - vec2(2, 4) + vec2(1, 1)).xyz;\n  else if (uv.x < 3.0*size && uv.y < 1.0*size)\n    diffuse = texture2D( tiles[ 8], uv * 4.0 - vec2(3, 1) + vec2(1, 1)).xyz;\n  else if (uv.x < 3.0*size && uv.y < 2.0*size)\n    diffuse = texture2D( tiles[ 9], uv * 4.0 - vec2(3, 2) + vec2(1, 1)).xyz;\n  else if (uv.x < 3.0*size && uv.y < 3.0*size)\n    diffuse = texture2D( tiles[10], uv * 4.0 - vec2(3, 3) + vec2(1, 1)).xyz;\n  else if (uv.x < 3.0*size && uv.y < 4.0*size)\n    diffuse = texture2D( tiles[11], uv * 4.0 - vec2(3, 4) + vec2(1, 1)).xyz;\n  else if (uv.x < 4.0*size && uv.y < 1.0*size)\n    diffuse = texture2D( tiles[12], uv * 4.0 - vec2(4, 1) + vec2(1, 1)).xyz;\n  else if (uv.x < 4.0*size && uv.y < 2.0*size)\n    diffuse = texture2D( tiles[13], uv * 4.0 - vec2(4, 2) + vec2(1, 1)).xyz;\n  else if (uv.x < 4.0*size && uv.y < 3.0*size)\n    diffuse = texture2D( tiles[14], uv * 4.0 - vec2(4, 3) + vec2(1, 1)).xyz;\n  else\n    diffuse = texture2D( tiles[15], uv * 4.0 - vec2(4, 4) + vec2(1, 1)).xyz;\n  \n  float phong      = max(0.0, pow(dot( vNormal, normalize(vec3( -0.3, 0.4, 0.7))), 0.6))*0.4 + 0.65;\n  float specular   = max(0.0, pow(dot( vNormal, normalize(vec3( -0.3, 0.4, 0.7)) ), 60.0));\n  float atmosphere = pow(1.0 - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) ), 2.0) * 0.7;\n  gl_FragColor     = vec4( phong * diffuse + atmosphere + specular * 0.1, opacity );\n}"},atmosphere:{uniforms:{bgColor:{type:"v3",value:BACKGROUND}},vertexShader:"varying vec3 vNormal;\nvoid main() {\n  vNormal = normalize( normalMatrix * normal );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform vec3 bgColor;\nvarying vec3 vNormal;\n\nvoid main() {\n  float intensity = max(0.0, -0.05 + pow( -dot( vNormal, vec3( 0, 0, 1.0 ) ) + 0.5, 5.0 ));\n  gl_FragColor = vec4(vec3( 1.0, 1.0, 1.0) * intensity + bgColor * (1.0-intensity), 1.0 );\n}"}};return Display3D}(HG.Display)}.call(this);function timeline(inHiventHandler){var timeline={};timeline.initTimeline=initTimeline;timeline.resizeTimeline=resizeTimeline;timeline.drawScroller=drawScroller;timeline.setNowDate=setNowDate;timeline.setPeriod=setPeriod;timeline.setHistEvents=setHistEvents;timeline.setMapExtent=setMapExtent;timeline.getNow=getNow;timeline.getPeriodStart=getPeriodStart;timeline.getPeriodEnd=getPeriodEnd;timeline.getCategories=getCategories;timeline.addListener=addListener;timeline.catChangeHandler=catChangeHandler;timeline.clickMouse=clickMouse;timeline.moveMouse=moveMouse;timeline.releaseMouse=releaseMouse;timeline.clickMoveButtonLeft=clickMoveButtonLeft;timeline.clickMoveButtonRight=clickMoveButtonRight;timeline.zoom=zoom;timeline.togglePlayer=togglePlayer;var minDate,maxDate;var now={};var histEvents=[];var extent=[];var listeners=[];var tlMain;var tlScroller;var tlDateMarkers;var refDate,refPos;var dayDist;var leftPos,rightPos;var innerThres;var markerInterval;var hiventMarkers=[];var playerIntervalTime;var playerInterval;var playerAnim;var downScroller;var downNowMarker;var lastPos;var totalDragMovement;var moveInterval;var mouseEvent;function initTimeline(){now.date=1825;now.marker=$("#nowMarkerWrap")[0];now.marker.markerDate=now;minDate=1820;maxDate=1845;tlMain=$("#tlMain")[0];tlScroller=$("#tlScroller")[0];tlDateMarkers=$("#tlDateMarkers")[0];refDate=now.date;refPos=0;leftPos=0;rightPos=0;dayDist=.05;innerThres=0;markerInterval=0;playerIntervalTime=8e3;playerInterval=null;playerAnim=1600;downScroller=false;downNowMarker=false;lastPos=0;totalDragMovement=0;moveInterval=null;mouseEvent=null;initHivents();$("#polDate").text(decYearToString(now.date));$(tlScroller).width($("#tlMain").width()*1.5);drawScroller();setTimeout(startAni,300);function startAni(){var desPos=tlMain.offsetWidth*.618;var actPos=rightPos-tlMain.scrollLeft;if(Math.abs(desPos-actPos)>3){scrollTimeline((desPos-actPos)/3,true);setTimeout(startAni,50)}else{scrollTimeline(desPos-actPos,true);innerThres=tlMain.offsetWidth*.1;periodChanged()}}}function resizeTimeline(){innerThres=tlMain.offsetWidth*.1;$(tlScroller).width(tlMain.offsetWidth*1.5);drawScroller()}function setNowDate(date){if(date)date=anyToDecYear(date);else date=now.date;var pos=decYearToPos(date);setNowPos(pos);nowChanged()}function setNowPos(pos){var minPos=Math.max(decYearToPos(minDate),$(tlMain).scrollLeft()+now.marker.offsetWidth/2);var maxPos=Math.min(decYearToPos(maxDate),tlMain.offsetWidth+$(tlMain).scrollLeft()-now.marker.offsetWidth/2);pos=Math.min(maxPos,Math.max(minPos,pos));now.date=posToDecYear(pos);$(now.marker).css("left",pos);$("#polDate").text(decYearToString(now.date))}function synchNow(){var nowPos=decYearToPos(now.date);var leftThres=$("#tlMain").scrollLeft()+innerThres;var rightThres=$("#tlMain").scrollLeft()+$("#tlMain").width()-innerThres;if(nowPos>=leftThres&&nowPos<=rightThres){return}if(nowPos<leftThres){now.date=posToDecYear(leftThres)}else{now.date=posToDecYear(rightThres)}$("#polDate").text(decYearToString(now.date));$(now.marker).css("left",decYearToPos(now.date));nowChanged()}function setPeriod(start,end){if(start>end){var temp=start;start=end;end=temp}start=Math.max(start,minDate);end=Math.min(end,maxDate);if(end-start<3){if(end<maxDate-3)end=start+3;else start=end-3}dayDist=tlMain.offsetWidth/dayDiff(start,end);refDate=now.date;refPos=dayDiff(start,now.date)*dayDist+$(tlMain).scrollLeft();drawScroller();synchNow();periodChanged()}function setMapExtent(ext){extent[0]=ext[0].lon;extent[1]=ext[0].lat;extent[2]=ext[1].lon;extent[3]=ext[1].lat;var list=histEvents;for(var i in list){var x=histEvents[i].data.properties.lon;var y=histEvents[i].data.properties.lat;var marker=$("#event"+histEvents[i].data.properties.histEventID);if(x<=extent[2]&&x>=extent[0]&&y<=extent[3]&&y>=extent[1]){marker.css("display","block")}else{marker.css("display","none")}}}function setHistEvents(eventArr){histEvents=eventArr}function getNow(){return now}function getPeriodStart(){return posToDate(0)}function getPeriodEnd(){return posToDate(tlMain.offsetWidth)}function getCategories(){var social=$("#catSociety").is(":checked");var domestic=$("#catDomestic").is(":checked");var foreign=$("#catForeign").is(":checked");return{social:social,domestic:domestic,foreign:foreign,asUrlParam:function(){return(social?"&social=1":"&social=0")+(domestic?"&domestic=1":"&domestic=0")+(foreign?"&foreign=1":"&foreign=0")}}}function addListener(lis){listeners.push(lis);lis.nowChanged(decYearToDate(now.date));lis.periodChanged(posToDate(0),posToDate(tlMain.offsetWidth));lis.categoryChanged(getCategories())}function nowChanged(){var d1=decYearToDate(now.date);for(var idx in listeners){listeners[idx].nowChanged(d1)}}function periodChanged(){var d1=posToDate($(tlMain).scrollLeft());var d2=posToDate(tlMain.offsetWidth+$(tlMain).scrollLeft());for(var i in listeners){listeners[i].periodChanged(d1,d2)}}function catChangeHandler(evt){categoryChanged()}function categoryChanged(){var cats=getCategories();for(var i in listeners){listeners[i].categoryChanged(cats)}}function drawScroller(){$(".eventMarker").remove();$(".yearMarker").remove();var minDist=45;var yearIntervals=[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3];var intervalIt=0;while(dayDist*365.242199<minDist/yearIntervals[intervalIt]){intervalIt++;var xxxxxxx=1}markerInterval=yearIntervals[intervalIt];$(now.marker).css("left",decYearToPos(now.date));var firstYear=Math.ceil(now.date);firstYear=firstYear+(markerInterval-firstYear%markerInterval);if(firstYear>maxDate)firstYear-=markerInterval;$("#tlDateMarkers").append(makeYearMarker(firstYear));leftPos=rightPos=decYearToPos(firstYear);appendYearMarkers();var perStart=Math.max(Math.round(posToDecYear($(tlMain).scrollLeft())),minDate);var perEnd=Math.min(Math.round(posToDecYear(tlMain.offsetWidth+$(tlMain).scrollLeft())),Math.floor(maxDate));$("#periodStart").val(perStart);$("#periodEnd").val(perEnd);updateHivents()}function appendYearMarkers(){while(leftPos>0){var prevYear=Math.round(posToDecYear(leftPos))-markerInterval;if(prevYear<minDate)break;$("#tlDateMarkers").prepend(makeYearMarker(prevYear));leftPos=decYearToPos(prevYear)}while(rightPos<tlScroller.offsetWidth){var nextYear=Math.round(posToDecYear(rightPos))+markerInterval;if(nextYear>maxDate)break;$("#tlDateMarkers").append(makeYearMarker(nextYear));rightPos=decYearToPos(nextYear)}}function stripYearMarkers(){while(leftPos<=0){$("#tlDateMarkers > div.yearMarker:first").remove();var leftYear=Math.round(posToDecYear(leftPos));leftPos=decYearToPos(leftYear+markerInterval)}while(rightPos>=tlScroller.offsetWidth){$("#tlDateMarkers > div.yearMarker:last").remove();var rightYear=Math.round(posToDecYear(rightPos));rightPos=decYearToPos(rightYear-markerInterval)}}function makeYearMarker(year){var newMarker=document.createElement("div");newMarker.setAttribute("id",year);newMarker.setAttribute("class","yearMarker "+yearMarkerClass(year));newMarker.style.left=decYearToPos(year)+"px";newMarker.innerHTML="<p>"+year+"</p>";newMarker.markerDate={date:year};return newMarker}function yearMarkerClass(year){if(year%(20*markerInterval)==0)return"yearMark1";else if(year%(5*markerInterval)==0)return"yearMark2";else return"yearMark3"}function initHivents(){inHiventHandler.onHiventsLoaded(function(handles){for(var i=0;i<handles.length;i++){var hivent=handles[i].getHivent();var date=new Date(hivent.date);var posX=dateToPos(date);var hiventMarker=new HG.HiventMarkerTimeline(handles[i],tlScroller,posX);hiventMarkers.push(hiventMarker)}})}function updateHivents(){for(var i=0;i<hiventMarkers.length;i++){var date=new Date(hiventMarkers[i].getHiventHandle().getHivent().date);var posX=dateToPos(date);hiventMarkers[i].setPosition(posX)}}function eventUITarget(evt,node){return $(evt.target).closest(node).length==1}function togglePlayer(evt){var p1=$("#histPlayer1");var p2=$("#histPlayer2");var p3=$("#histPlayer3");var state=null;if(p1.hasClass("active"))state=1;if(p2.hasClass("active"))state=2;if(p3.hasClass("active"))state=3;var playButt=null;if(eventUITarget(evt,p1))playButt=1;if(eventUITarget(evt,p2))playButt=2;if(eventUITarget(evt,p3))playButt=3;stopPlayer();if(playButt==1)p1.button("toggle");if(playButt==2)p2.button("toggle");if(playButt==3)p3.button("toggle");if(state==playButt)return;else{if(state==1)p1.button("toggle");if(state==2)p2.button("toggle");if(state==3)p3.button("toggle");startPlayer(playButt)}}function startPlayer(speed){var counter=0;playerInterval=setInterval(function(){var nowPos=decYearToPos(now.date);nowPos+=5*speed;var moveDiff=0;if(nowPos<innerThres){moveDiff=innerThres-nowPos}else if(nowPos>tlMain.offsetWidth-innerThres){moveDiff=tlMain.offsetWidth-innerThres-nowPos
}if(moveDiff!=0){var f;setTimeout(f=function(){if(Math.abs(moveDiff)<1)return;scrollTimeline(moveDiff/2);moveDiff/=2;setTimeout(f,20)},20)}setNowPos(nowPos);if(now.date>=maxDate){stopPlayer();var p1=$("#histPlayer1");var p2=$("#histPlayer2");var p3=$("#histPlayer3");if(p1.hasClass("active"))p1.button("toggle");if(p2.hasClass("active"))p2.button("toggle");if(p3.hasClass("active"))p3.button("toggle")}if(counter==50){nowChanged();periodChanged();counter=0}counter++},10)}function stopPlayer(){clearInterval(playerInterval);playerInterval=null;$(now.marker).stop()}function clickMouse(evt){if(evt.which!=1)return;$("body").attr("style","cursor: move;");lastPos=evt.pageX;totalDragMovement=0;if(evt.target.id=="nowMarkerMain"||evt.target.id=="nowMarkerHead"){downNowMarker=true;return}if(evt.target.id=="polDate")return;else{downScroller=true}}function moveMouse(evt){var xDist=evt.pageX-lastPos;totalDragMovement+=Math.abs(xDist);if(downScroller){scrollTimeline(xDist);synchNow()}if(downNowMarker){dragNowMarker(evt)}lastPos=evt.pageX}function releaseMouse(evt){$("body").attr("style","");if(downScroller||moveInterval){periodChanged()}if(downScroller&&totalDragMovement<5){setNowDate(clickToDecYear(evt))}var nowPos=$(now.marker).position().left-$(tlMain).scrollLeft();var moveDiff=0;if(nowPos<innerThres){moveDiff=innerThres-nowPos}else if(nowPos>tlMain.offsetWidth-innerThres){moveDiff=tlMain.offsetWidth-innerThres-nowPos}if(moveDiff!=0){var f;setTimeout(f=function(){if(Math.abs(moveDiff)<1)return;scrollTimeline(moveDiff/2);moveDiff/=2;setTimeout(f,50)},50)}setNowDate();downScroller=false;downNowMarker=false;clearInterval(moveInterval);moveInterval=null}function clickMoveButtonRight(pix){var buttonMoveSpeed=pix;var moveStartTime=(new Date).getTime();clearInterval(moveInterval);moveInterval=setInterval(function(){var nowTime=(new Date).getTime();var speedup=Math.min(.05,(nowTime-moveStartTime)/5e4);if(buttonMoveSpeed>0){zoomFromPos(0,buttonMoveSpeed+speedup)}else{zoomFromPos(0,buttonMoveSpeed-speedup)}synchNow()},20)}function clickMoveButtonLeft(pix){var buttonMoveSpeed=pix;var moveStartTime=(new Date).getTime();clearInterval(moveInterval);moveInterval=setInterval(function(){var nowTime=(new Date).getTime();var speedup=Math.min(.05,(nowTime-moveStartTime)/5e4);if(buttonMoveSpeed>0){zoomFromPos($("#tlMain").width()-0,buttonMoveSpeed+speedup)}else{zoomFromPos($("#tlMain").width()-0,buttonMoveSpeed-speedup)}synchNow()},20)}function scrollTimeline(pix,ignoreLimit){var fixDist=tlScroller.offsetWidth/3;if(!ignoreLimit){pix=Math.min(pix,tlMain.offsetWidth*.382-(leftPos-tlMain.scrollLeft));pix=Math.max(pix,tlMain.offsetWidth*.618-(rightPos-tlMain.scrollLeft))}if(pix==0)return;if(tlMain.scrollLeft-pix<=0){scrollFixup(fixDist);$("#tlMain").scrollLeft(tlMain.scrollLeft+fixDist)}else if(tlMain.scrollLeft-pix>=tlScroller.offsetWidth-tlMain.offsetWidth){scrollFixup(-fixDist);$("#tlMain").scrollLeft(tlMain.scrollLeft-fixDist)}$("#tlMain").scrollLeft(tlMain.scrollLeft-pix);var start=Math.ceil(posToDecYear(tlMain.scrollLeft));var end=Math.floor(posToDecYear(tlMain.scrollLeft+tlMain.offsetWidth));$("#periodStart").val(Math.max(start,minDate));$("#periodEnd").val(Math.min(end,Math.floor(maxDate)))}function scrollFixup(pix){var list=$("#tlDateMarkers > div");list.each(function(idx){$(this).css("left",decYearToPos(this.markerDate.date)+pix)});refPos+=pix;leftPos+=pix;rightPos+=pix;updateHivents();appendYearMarkers();stripYearMarkers()}function dragNowMarker(evt){var moveFact=.2;mouseEvent=evt;if(moveInterval===null){var moveCounter=0;moveInterval=setInterval(function(){var posX=mouseEvent.pageX-$(tlMain).offset().left;if(posX<innerThres){var off=(innerThres-posX)*moveFact;scrollTimeline(off)}else if(posX>tlMain.offsetWidth-innerThres){var off=(tlMain.offsetWidth-innerThres-posX)*moveFact;scrollTimeline(off)}var newNowPos=posX+$(tlMain).scrollLeft();setNowPos(newNowPos);if(++moveCounter%5==0){nowChanged();periodChanged()}},20)}}function zoomFromPos(pos,delta){var evt={pageX:pos+$("#tlMain").offset().left};zoom(evt,delta)}function zoom(evt,delta){if(evt.preventDefault)evt.preventDefault();var zoomFactor=1.15;var minDist=tlMain.offsetWidth/dayDiff(minDate,maxDate);var maxDist=.45;if(evt){refDate=clickToDecYear(evt);refPos=evt.pageX-$("#tlScroller").offset().left}else{refDate=posToDecYear(tlMain.offsetWidth/2);refPos=tlMain.offsetWidth/2}dayDist*=Math.pow(zoomFactor,delta);dayDist=Math.min(Math.max(dayDist,minDist),maxDist);drawScroller();synchNow();if(leftPos-tlMain.scrollLeft>=tlMain.offsetWidth*.382){scrollTimeline(tlMain.offsetWidth*.382-(leftPos-tlMain.scrollLeft))}else if(rightPos-tlMain.scrollLeft<=tlMain.offsetWidth*.618){scrollTimeline(tlMain.offsetWidth*.618-(rightPos-tlMain.scrollLeft))}synchNow();periodChanged()}function debugYearMarkers(){_d.clearlog();var list=$(".yearMarker");list.each(function(idx){var year=$(this).attr("id");var actPos=$(this).position().left;var assPos=decYearToPos(year);var diff=actPos-assPos;_d.log(year+" "+actPos+" "+assPos+" "+diff)})}function dateToPos(date){date=dateToDecYear(date);return dayDiff(refDate,date)*dayDist+refPos}function decYearToPos(decYear){return dayDiff(refDate,decYear)*dayDist+refPos}function posToDate(pos){var decYear=refDate+(pos-refPos)/dayDist/365.242199;return decYearToDate(decYear)}function posToDecYear(pos){return refDate+(pos-refPos)/dayDist/365.242199}function decYearToString(date){var dateObj=decYearToDate(date);return padZero(dateObj.getDate())+"."+padZero(dateObj.getMonth()+1)+"."+dateObj.getFullYear()}function decYearToDate(decYear){if(decYear instanceof Date)return decYear;var fullYear=Math.floor(decYear);if(isLeapYear(fullYear))return new Date(fullYear,0,(decYear-fullYear)*366+1,0,0,0);else return new Date(fullYear,0,(decYear-fullYear)*365+1,0,0,0)}function dateToDecYear(date){var fullYear=date.getFullYear();var diff=dayDiff(new Date(fullYear,0,1),date);if(isLeapYear(fullYear))return fullYear+diff/366;else return fullYear+diff/365}function anyToDecYear(str){if(str instanceof Date)return dateToDecYear(str);if(!isNaN(str))return str;var dateParts=String(str).split(".");var dateObj=new Date(dateParts[2],dateParts[1]-1,dateParts[0]);return dateToDecYear(dateObj)}function clickToDate(evt){var clickPix=evt.pageX-$("#tlScroller").offset().left;return posToDate(clickPix)}function clickToDecYear(evt){var clickPix=evt.pageX-$("#tlScroller").offset().left;return posToDecYear(clickPix)}function dayDiff(date1,date2){if(date1 instanceof Date==false)date1=decYearToDate(date1);if(date2 instanceof Date==false)date2=decYearToDate(date2);var msDiff=date2.getTime()-date1.getTime();return msDiff/864e5}function isLeapYear(year){if(year%4==0){if(year%100==0){if(year%400==0){return true}return false}return true}return false}function padZero(int){return int<10?"0"+int:int}return timeline}var HG=HG||{};HG.Histrip=function(inCoords,inCategory){this.coords=inCoords;this.category=inCategory;return this};var HG=HG||{};HG.HistripHandle=function(inHistrip){var hovered=false;var onHoverCallbacks=[];var onUnHoverCallbacks=[];this.getHistrip=function(){return inHistrip};this.hover=function(){if(!hovered){hovered=true;for(var i=0;i<onHoverCallbacks.length;i++)onHoverCallbacks[i]()}};this.unHover=function(){if(hovered){hovered=false;for(var i=0;i<onUnHoverCallbacks.length;i++)onUnHoverCallbacks[i]()}};this.onHover=function(callbackFunc){if(callbackFunc&&typeof callbackFunc==="function"){onHoverCallbacks.push(callbackFunc)}};this.onUnHover=function(callbackFunc){if(callbackFunc&&typeof callbackFunc==="function"){onUnHoverCallbacks.push(callbackFunc)}};return this};var HG=HG||{};HG.HistripHandler=function(){this.create=function(){$.getJSON("data/histrips.json",function(h){for(var i=0;i<h.length;i++){var histrip=new HG.Histrip(h[i].coords,h[i].category);histripHandles.push(new HG.HistripHandle(histrip))}histripsLoaded=true;for(var i=0;i<onHistripsLoadedCallbacks.length;i++)onHistripsLoadedCallbacks[i](histripHandles)})};this.getAllHistripHandles=function(){return histripHandles};this.onHistripsLoaded=function(callbackFunc){if(callbackFunc&&typeof callbackFunc==="function"){if(!histripsLoaded)onHistripsLoadedCallbacks.push(callbackFunc);else callbackFunc(histripHandles)}};var histripHandles=[];var histripsLoaded=false;var onHistripsLoadedCallbacks=[];this.create();return this};var HG=HG||{};var HG=HG||{};HG.Hivent=function(inName,inCategory,inDate,inDisplayDate,inLong,inLat,inDescription,inParties){this.name=inName;this.category=inCategory;this.date=inDate;this.displayDate=inDisplayDate;this.long=inLong;this.lat=inLat;this.description=inDescription;this.parties=inParties;return this};var HG=HG||{};HG.activeHivents=[];HG.HiventHandle=function(inHivent){var activated=false;var marked=false;var linked=false;var focussed=false;var onActiveCallbacks=[];var onInActiveCallbacks=[];var onMarkCallbacks=[];var onUnMarkCallbacks=[];var onLinkCallbacks=[];var onUnLinkCallbacks=[];var onUnFocusCallbacks=[];var onFocusCallbacks=[];var onUnFocusCallbacks=[];this.getHivent=function(){return inHivent};this.activeAll=function(mousePixelPosition){activated=true;HG.activeHivents.push(this);for(var i=0;i<onActiveCallbacks.length;i++){for(var j=0;j<onActiveCallbacks[i][1].length;j++){onActiveCallbacks[i][1][j](mousePixelPosition)}}};this.active=function(obj,mousePixelPosition){activated=true;HG.activeHivents.push(this);for(var i=0;i<onActiveCallbacks.length;i++){if(onActiveCallbacks[i][0]==obj){for(var j=0;j<onActiveCallbacks[i][1].length;j++){onActiveCallbacks[i][1][j](mousePixelPosition)}break}}};this.inActiveAll=function(mousePixelPosition){activated=false;var index=$.inArray(this,HG.activeHivents);if(index>=0)delete HG.activeHivents[index];for(var i=0;i<onInActiveCallbacks.length;i++){for(var j=0;j<onInActiveCallbacks[i][1].length;j++){onInActiveCallbacks[i][1][j](mousePixelPosition)}}};this.inActive=function(obj,mousePixelPosition){activated=false;var index=$.inArray(this,HG.activeHivents);if(index>=0)delete HG.activeHivents[index];for(var i=0;i<onInActiveCallbacks.length;i++){if(onInActiveCallbacks[i][0]==obj){for(var j=0;j<onInActiveCallbacks[i][1].length;j++){onInActiveCallbacks[i][1][j](mousePixelPosition)}break}}};this.toggleActiveAll=function(mousePixelPosition){activated=!activated;if(activated){this.activeAll(mousePixelPosition)}else{this.inActiveAll(mousePixelPosition)}};this.toggleActive=function(obj,mousePixelPosition){activated=!activated;if(activated){this.active(obj,mousePixelPosition)}else{this.inActive(obj,mousePixelPosition)}};this.markAll=function(mousePixelPosition){if(!marked){marked=true;for(var i=0;i<onMarkCallbacks.length;i++){for(var j=0;j<onMarkCallbacks[i][1].length;j++){onMarkCallbacks[i][1][j](mousePixelPosition)}}}};this.mark=function(obj,mousePixelPosition){if(!marked){marked=true;for(var i=0;i<onMarkCallbacks.length;i++){if(onMarkCallbacks[i][0]==obj){for(var j=0;j<onMarkCallbacks[i][1].length;j++){onMarkCallbacks[i][1][j](mousePixelPosition)}break}}}};this.unMarkAll=function(mousePixelPosition){if(marked){marked=false;for(var i=0;i<onUnMarkCallbacks.length;i++){for(var j=0;j<onUnMarkCallbacks[i][1].length;j++){onUnMarkCallbacks[i][1][j](mousePixelPosition)}}}};this.unMark=function(obj,mousePixelPosition){if(marked){marked=false;for(var i=0;i<onUnMarkCallbacks.length;i++){if(onUnMarkCallbacks[i][0]==obj){for(var j=0;j<onUnMarkCallbacks[i][1].length;j++){onUnMarkCallbacks[i][1][j](mousePixelPosition)}break}}}};this.linkAll=function(mousePixelPosition){if(!linked){linked=true;for(var i=0;i<onLinkCallbacks.length;i++){for(var j=0;j<onLinkCallbacks[i][1].length;j++){onLinkCallbacks[i][1][j](mousePixelPosition)}}}};this.link=function(obj,mousePixelPosition){if(!linked){linked=true;for(var i=0;i<onLinkCallbacks.length;i++){if(onLinkCallbacks[i][0]==obj){for(var j=0;j<onLinkCallbacks[i][1].length;j++){onLinkCallbacks[i][1][j](mousePixelPosition)}break}}}};this.unLinkAll=function(obj,mousePixelPosition){if(linked){linked=false;for(var i=0;i<onUnLinkCallbacks.length;i++){for(var j=0;j<onUnLinkCallbacks[i][1].length;j++){onUnLinkCallbacks[i][1][j](mousePixelPosition)}}}};this.unLink=function(mousePixelPosition){if(linked){linked=false;for(var i=0;i<onUnLinkCallbacks.length;i++){if(onUnLinkCallbacks[i][0]==obj){for(var j=0;j<onUnLinkCallbacks[i][1].length;j++){onUnLinkCallbacks[i][1][j](mousePixelPosition)}break}}}};this.focusAll=function(mousePixelPosition){focussed=true;for(var i=0;i<onFocusCallbacks.length;i++){for(var j=0;j<onFocusCallbacks[i][1].length;j++){onFocusCallbacks[i][1][j](mousePixelPosition)}}};this.focus=function(obj,mousePixelPosition){focussed=true;for(var i=0;i<onFocusCallbacks.length;i++){if(onFocusCallbacks[i][0]==obj){for(var j=0;j<onFocusCallbacks[i][1].length;j++){onFocusCallbacks[i][1][j](mousePixelPosition)}break}}};this.unFocusAll=function(mousePixelPosition){focussed=false;for(var i=0;i<onUnFocusCallbacks.length;i++){for(var j=0;j<onUnFocusCallbacks[i][1].length;j++){onUnFocusCallbacks[i][1][j](mousePixelPosition)}}};this.unFocus=function(obj,mousePixelPosition){focussed=false;for(var i=0;i<onUnFocusCallbacks.length;i++){if(onUnFocusCallbacks[i][0]==obj){for(var j=0;j<onUnFocusCallbacks[i][1].length;j++){onUnFocusCallbacks[i][1][j](mousePixelPosition)}break}}};this.onActive=function(obj,callbackFunc){if(callbackFunc&&typeof callbackFunc==="function"){for(var i=0;i<onActiveCallbacks.length;i++){if(onActiveCallbacks[i][0]==obj){onActiveCallbacks[i][1].push(callbackFunc);return}}onActiveCallbacks.push([obj,[callbackFunc]])}};this.onInActive=function(obj,callbackFunc){if(callbackFunc&&typeof callbackFunc==="function"){for(var i=0;i<onInActiveCallbacks.length;i++){if(onInActiveCallbacks[i][0]==obj){onInActiveCallbacks[i][1].push(callbackFunc);return}}onInActiveCallbacks.push([obj,[callbackFunc]])}};this.onMark=function(obj,callbackFunc){if(callbackFunc&&typeof callbackFunc==="function"){for(var i=0;i<onMarkCallbacks.length;i++){if(onMarkCallbacks[i][0]==obj){onMarkCallbacks[i][1].push(callbackFunc);return}}onMarkCallbacks.push([obj,[callbackFunc]])}};this.onUnMark=function(obj,callbackFunc){if(callbackFunc&&typeof callbackFunc==="function"){for(var i=0;i<onUnMarkCallbacks.length;i++){if(onUnMarkCallbacks[i][0]==obj){onUnMarkCallbacks[i][1].push(callbackFunc);return}}onUnMarkCallbacks.push([obj,[callbackFunc]])}};this.onLink=function(obj,callbackFunc){if(callbackFunc&&typeof callbackFunc==="function"){for(var i=0;i<onLinkCallbacks.length;i++){if(onLinkCallbacks[i][0]==obj){onLinkCallbacks[i][1].push(callbackFunc);return}}onLinkCallbacks.push([obj,[callbackFunc]])}};this.onUnLink=function(obj,callbackFunc){if(callbackFunc&&typeof callbackFunc==="function"){for(var i=0;i<onUnLinkCallbacks.length;i++){if(onUnLinkCallbacks[i][0]==obj){onUnLinkCallbacks[i][1].push(callbackFunc);return}}onUnLinkCallbacks.push([obj,[callbackFunc]])}};this.onFocus=function(obj,callbackFunc){if(callbackFunc&&typeof callbackFunc==="function"){for(var i=0;i<onFocusCallbacks.length;i++){if(onFocusCallbacks[i][0]==obj){onFocusCallbacks[i][1].push(callbackFunc);return}}onFocusCallbacks.push([obj,[callbackFunc]])}};this.onUnFocus=function(obj,callbackFunc){if(callbackFunc&&typeof callbackFunc==="function"){for(var i=0;i<onUnFocusCallbacks.length;i++){if(onUnFocusCallbacks[i][0]==obj){onUnFocusCallbacks[i][1].push(callbackFunc);return}}onUnFocusCallbacks.push([obj,[callbackFunc]])}};return this};HG.deactivateAllHivents=function(){for(var i=0;i<HG.activeHivents.length;i++){if(HG.activeHivents[i]){HG.activeHivents[i].inActiveAll({x:0,y:0})}}HG.activeHivents=[]};var HG=HG||{};HG.HiventHandler=function(){var hiventHandles=[];var hiventsLoaded=false;var onHiventsLoadedCallbacks=[];function init(){$.getJSON("data/hivents.json",function(h){for(var i=0;i<h.length;i++){var hivent=new HG.Hivent(h[i].name,h[i].category,h[i].date,h[i].displayDate,h[i].long,h[i].lat,h[i].description,h[i].parties);hiventHandles.push(new HG.HiventHandle(hivent))}hiventsLoaded=true;for(var i=0;i<onHiventsLoadedCallbacks.length;i++)onHiventsLoadedCallbacks[i](hiventHandles)})}this.getAllHiventHandles=function(){return hiventHandles};this.onHiventsLoaded=function(callbackFunc){if(callbackFunc&&typeof callbackFunc==="function"){if(!hiventsLoaded)onHiventsLoadedCallbacks.push(callbackFunc);else callbackFunc(hiventHandles)}};init();return this};var HG=HG||{};HG.hiventInfoCount=0;HG.HiventMarker=function(inHiventHandle,inParent){var self=this;var hiventInfo;this.getHiventHandle=function(){return inHiventHandle};this.showHiventName=function(displayPosition){hiventInfo.style.left=displayPosition.x+"px";hiventInfo.style.top=displayPosition.y+"px";$(hiventInfo).tooltip("show")};this.hideHiventName=function(displayPosition){$(hiventInfo).tooltip("hide")};this.showHiventInfo=function(displayPosition){hiventInfo.style.left=displayPosition.x+"px";hiventInfo.style.top=displayPosition.y+"px";$(hiventInfo).popover("show");$(hiventInfo).tooltip("hide")};this.hideHiventInfo=function(displayPosition){$(hiventInfo).popover("hide")};this.enableShowName=function(){inHiventHandle.onMark(self,this.showHiventName);inHiventHandle.onUnMark(self,this.hideHiventName)};this.enableShowInfo=function(){inHiventHandle.onActive(self,this.showHiventInfo);inHiventHandle.onInActive(self,this.hideHiventInfo)};function init(){hiventInfo=document.createElement("div");hiventInfo.class="btn";hiventInfo.id="hiventInfo_"+HG.hiventInfoCount;hiventInfo.style.position="absolute";hiventInfo.style.left="0px";hiventInfo.style.top="0px";hiventInfo.style.visibility="hidden";hiventInfo.style.pointerEvents="none";if(inParent)inParent.appendChild(hiventInfo);var hivent=inHiventHandle.getHivent();$(hiventInfo).tooltip({title:hivent.name,placement:"top"});var hiventContent='<p align="right">'+hivent.displayDate+"</p>"+hivent.description;$(hiventInfo).popover({title:hivent.name,placement:"top",html:"true",content:hiventContent});HG.hiventInfoCount++}init();return this};var HG=HG||{};HG.hiventMarker2DCount=0;HG.visibleMarkers2D=[];HG.HiventMarker2D=function(inHivent,inDisplay,inMap){HG.HiventMarker.call(this,inHivent,inMap.getPanes()["popupPane"]);L.Marker.call(this,[inHivent.getHivent().lat,inHivent.getHivent().long]);this.addTo(inMap);var self=this;var position=new L.Point(0,0);updatePosition();var radius=40;this.onMouseOver=function(e){var pos={x:position.x,y:position.y-radius};self.getHiventHandle().mark(self,pos);self.getHiventHandle().linkAll(pos)};this.onMouseOut=function(e){var pos={x:position.x,y:position.y-radius};self.getHiventHandle().unMark(self,pos);self.getHiventHandle().unLinkAll(pos)};this.onclick=function(e){var pos={x:position.x,y:position.y-radius};self.getHiventHandle().toggleActive(self,pos)};this.on("mouseover",self.onMouseOver);this.on("mouseout",self.onMouseOut);this.on("click",self.onclick);inMap.on("zoomend",updatePosition);inMap.on("dragend",updatePosition);inMap.on("viewreset",updatePosition);inMap.on("zoomstart",this.hideHiventInfo);HG.visibleMarkers2D.push(this);function updatePosition(){position=inMap.latLngToLayerPoint(self.getLatLng())}this.getHiventHandle().onMark(self,function(mousePos){});this.getHiventHandle().onUnMark(self,function(mousePos){});this.getHiventHandle().onLink(self,function(mousePos){});this.getHiventHandle().onUnLink(self,function(mousePos){});this.getHiventHandle().onFocus(self,function(mousePos){if(inDisplay.isRunning()){inDisplay.focus(self.getHiventHandle().getHivent())}});this.enableShowName();this.enableShowInfo();return this};HG.HiventMarker2D.prototype=Object.create(L.Marker.prototype);var HG=HG||{};HG.hiventMarkerGeometry=0;HG.HiventMarker3D=function(inHivent,inDisplay,inParent){var self=this;if(HG.hiventMarkerGeometry==0)HG.hiventMarkerGeometry=new THREE.SphereGeometry(1,10,10);var hiventDefaultColor=new THREE.Vector3(.2,.2,.4);var hiventHighlightColor=new THREE.Vector3(1,.5,0);var Shaders={hivent:{uniforms:{color:{type:"v3",value:null}},vertexShader:["varying vec3 vNormal;","void main() {","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4(color, 1.0);","}"].join("\n")}};var shader=Shaders["hivent"];var uniforms=THREE.UniformsUtils.clone(shader.uniforms);uniforms["color"].value=hiventDefaultColor;var material=new THREE.ShaderMaterial({vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader,uniforms:uniforms});HG.HiventMarker.call(this,inHivent,inParent);THREE.Mesh.call(this,HG.hiventMarkerGeometry,material);this.getHiventHandle().onFocus(self,function(mousePos){if(inDisplay.isRunning()){inDisplay.focus(self.getHiventHandle().getHivent())}});this.getHiventHandle().onMark(self,function(mousePos){uniforms["color"].value=hiventHighlightColor});this.getHiventHandle().onUnMark(self,function(mousePos){uniforms["color"].value=hiventDefaultColor});this.getHiventHandle().onLink(self,function(mousePos){uniforms["color"].value=hiventHighlightColor});this.getHiventHandle().onUnLink(self,function(mousePos){uniforms["color"].value=hiventDefaultColor});this.enableShowName();this.enableShowInfo();return this};HG.HiventMarker3D.prototype=Object.create(THREE.Mesh.prototype);var HG=HG||{};HG.hiventMarkerTimelineCount=0;HG.visibleMarkers2D=[];HG.HiventMarkerTimeline=function(inHivent,inParent,inPosX,inPosY){HG.HiventMarker.call(this,inHivent,inParent);var hiventDefaultColor="#253563";var hiventHighlightColor="#ff8800";var self=this;var div;var position={x:inPosX,y:Math.floor($(inParent.parentNode).innerHeight()*.85)};var radius=4;div=document.createElement("div");div.id="hiventMarkerTimeline_"+HG.hiventMarker2DCount;div.style.position="absolute";div.style.width=2*radius+"px";div.style.height=2*radius+"px";div.style.borderRadius=radius+"px";div.style.backgroundColor=hiventDefaultColor;div.style.left=position.x+"px";div.style.top=position.y+"px";inParent.appendChild(div);div.onmouseover=function(e){var pos={x:position.x+radius,y:position.y+.6*radius};self.getHiventHandle().mark(self,pos);self.getHiventHandle().linkAll(pos)};div.onmouseout=function(e){var pos={x:position.x+radius,y:position.y+.6*radius};self.getHiventHandle().unMark(self,pos);self.getHiventHandle().unLinkAll(pos)};div.onclick=function(e){var pos={x:position.x+radius,y:position.y+.6*radius};self.getHiventHandle().focusAll(pos)};HG.hiventMarkerTimelineCount++;function setDivPos(pos){div.style.left=pos.x+"px";div.style.top=pos.y+"px"}this.getHiventHandle().onMark(self,function(mousePos){div.style.backgroundColor=hiventHighlightColor});this.getHiventHandle().onUnMark(self,function(mousePos){div.style.backgroundColor=hiventDefaultColor});this.getHiventHandle().onLink(self,function(mousePos){div.style.backgroundColor=hiventHighlightColor});this.getHiventHandle().onUnLink(self,function(mousePos){div.style.backgroundColor=hiventDefaultColor});this.enableShowName();this.getPosition=function(){return position};this.setPosition=function(posX){position.x=posX;div.style.left=position.x+"px"};this.hide=function(){div.style.display="none"};this.show=function(){div.style.display="block"};return this};var HG=HG||{};HG.VideoPlayer=function(inDivID){var divID=inDivID;var player;function onPlayerReady(event){event.target.playVideo()}function init(){player=new YT.Player(divID,{events:{onReady:onPlayerReady}})}this.stopVideo=function(){player.pauseVideo()};init();return this};var BrowserDetect={init:function(){this.canvasSupported=!!window.CanvasRenderingContext2D;this.webglContextSupported=!!window.WebGLRenderingContext;this.webglRenderingSupported=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return false}}();var info=this.searchString(this.dataBrowser)||{identity:"unknown"};this.browser=info.identity;this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.platformInfo=this.searchString(this.dataPlatform)||this.dataPlatform["unknown"];this.platform=this.platformInfo.identity;var browserInfo=this.urls[this.browser];if(!browserInfo){browserInfo=this.urls["unknown"]}else if(browserInfo.platforms){var info=browserInfo.platforms[this.platform];if(info){browserInfo=info}}this.urls=browserInfo},searchString:function(data){for(var i=0;i<data.length;i++){var info=data[i];var dataString=info.string;var dataProp=info.prop;this.versionSearchString=info.versionSearch||info.identity;if(dataString){if(dataString.indexOf(info.subString)!=-1){return info}}else if(dataProp){return info}}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index==-1){return}return parseFloat(dataString.substring(index+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Internet Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataPlatform:[{string:navigator.platform,subString:"Win",identity:"Windows",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"},{url:"http://www.google.com/chrome/",name:"Google Chrome"}]},{string:navigator.platform,subString:"Mac",identity:"Mac",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"},{url:"http://www.google.com/chrome/",name:"Google Chrome"},{url:"http://www.webkit.org/",name:"WebKit Developer Builds"}]},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"}]},{string:navigator.platform,subString:"iPad",identity:"iPad",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"}]},{string:navigator.userAgent,subString:"Android",identity:"Android",browsers:[{url:"https://market.android.com/details?id=org.mozilla.firefox",name:"Mozilla Firefox"},{url:"https://market.android.com/details?id=com.opera.browser",name:"Opera Mobile"}]},{string:navigator.platform,subString:"Linux",identity:"Linux",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"},{url:"http://www.google.com/chrome/",name:"Google Chrome"},{url:"http://www.opera.com/browser/next/",name:"Opera Next"}]},{string:"unknown",subString:"unknown",identity:"unknown",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"},{url:"http://www.google.com/chrome/",name:"Google Chrome"},{url:"http://www.opera.com/browser/next/",name:"Opera Next"},{url:"http://www.webkit.org/",name:"WebKit Developer Builds"}]}],urls:{Chrome:{upgradeUrl:"http://www.google.com/support/chrome/bin/answer.py?answer=95346",troubleshootingUrl:"http://www.google.com/support/chrome/bin/answer.py?answer=1220892"},Firefox:{upgradeUrl:"http://www.mozilla.com/en-US/firefox/new/",troubleshootingUrl:"https://support.mozilla.com/en-US/kb/how-do-i-upgrade-my-graphics-drivers"},Opera:{platforms:{Android:{upgradeUrl:"https://market.android.com/details?id=com.opera.browser",troubleshootingUrl:"http://www.opera.com/support/"}},upgradeUrl:"http://www.opera.com/browser/next/",troubleshootingUrl:"http://www.opera.com/support/"},Android:{upgradeUrl:null,troubleshootingUrl:null},Safari:{platforms:{"iPhone/iPod":{upgradeUrl:"http://www.apple.com/ios/",troubleshootingUrl:"http://www.apple.com/support/iphone/"},iPad:{upgradeUrl:"http://www.apple.com/ios/",troubleshootingUrl:"http://www.apple.com/support/ipad/"},Mac:{upgradeUrl:"http://www.webkit.org/",troubleshootingUrl:"http://www.webkit.org/blog/919/webgl-draft-specification-now-available/"}},upgradeUrl:"http://www.webkit.org/",troubleshootingUrl:"http://www.webkit.org/blog/919/webgl-draft-specification-now-available/"},unknown:{upgradeUrl:null,troubleshootingUrl:null}}};