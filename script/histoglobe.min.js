function timeline(t){function e(){function t(){var e=.618*ee.offsetWidth,n=le-ee.scrollLeft;Math.abs(e-n)>3?(D((e-n)/3,!0),setTimeout(t,50)):(D(e-n,!0),he=.1*ee.offsetWidth,d())}He.date=1825,He.marker=$("#nowMarkerWrap")[0],He.marker.markerDate=He,Q=1820,te=1845,ee=$("#tlMain")[0],ne=$("#tlScroller")[0],ie=$("#tlDateMarkers")[0],re=He.date,oe=0,se=0,le=0,ae=.05,he=0,ue=0,fe=8e3,ce=null,ve=1600,me=!1,de=!1,ye=0,pe=0,ge=null,xe=null,w(),$("#polDate").text(N(He.date)),$(ne).width(1.5*$("#tlMain").width()),g(),setTimeout(t,300)}function n(){he=.1*ee.offsetWidth,$(ne).width(1.5*ee.offsetWidth),g()}function i(t){t=t?Z(t):He.date;var e=W(t);r(e),m()}function r(t){var e=Math.max(W(Q),$(ee).scrollLeft()+He.marker.offsetWidth/2),n=Math.min(W(te),ee.offsetWidth+$(ee).scrollLeft()-He.marker.offsetWidth/2);t=Math.min(n,Math.max(e,t)),He.date=F(t),$(He.marker).css("left",t),$("#polDate").text(N(He.date))}function o(){var t=W(He.date),e=$("#tlMain").scrollLeft()+he,n=$("#tlMain").scrollLeft()+$("#tlMain").width()-he;t>=e&&n>=t||(He.date=e>t?F(e):F(n),$("#polDate").text(N(He.date)),$(He.marker).css("left",W(He.date)),m())}function a(t,e){if(t>e){var n=t;t=e,e=n}t=Math.max(t,Q),e=Math.min(e,te),3>e-t&&(te-3>e?e=t+3:t=e-3),ae=ee.offsetWidth/B(t,e),re=He.date,oe=B(t,He.date)*ae+$(ee).scrollLeft(),g(),o(),d()}function s(t){Me[0]=t[0].lon,Me[1]=t[0].lat,Me[2]=t[1].lon,Me[3]=t[1].lat;var e=_e;for(var n in e){var i=_e[n].data.properties.lon,r=_e[n].data.properties.lat,o=$("#event"+_e[n].data.properties.histEventID);i<=Me[2]&&i>=Me[0]&&r<=Me[3]&&r>=Me[1]?o.css("display","block"):o.css("display","none")}}function l(t){_e=t}function h(){return He}function u(){return O(0)}function f(){return O(ee.offsetWidth)}function c(){var t=$("#catSociety").is(":checked"),e=$("#catDomestic").is(":checked"),n=$("#catForeign").is(":checked");return{social:t,domestic:e,foreign:n,asUrlParam:function(){return(t?"&social=1":"&social=0")+(e?"&domestic=1":"&domestic=0")+(n?"&foreign=1":"&foreign=0")}}}function v(t){we.push(t),t.nowChanged(j(He.date)),t.periodChanged(O(0),O(ee.offsetWidth)),t.categoryChanged(c())}function m(){var t=j(He.date);for(var e in we)we[e].nowChanged(t)}function d(){var t=O($(ee).scrollLeft()),e=O(ee.offsetWidth+$(ee).scrollLeft());for(var n in we)we[n].periodChanged(t,e)}function y(){p()}function p(){var t=c();for(var e in we)we[e].categoryChanged(t)}function g(){$(".eventMarker").remove(),$(".yearMarker").remove();for(var t=45,e=[1,2,5,10,20,50,100,200,500,1e3,2e3,5e3],n=0;365.242199*ae<t/e[n];)n++;ue=e[n],$(He.marker).css("left",W(He.date));var i=Math.ceil(He.date);i+=ue-i%ue,i>te&&(i-=ue),$("#tlDateMarkers").append(_(i)),se=le=W(i),x();var r=Math.max(Math.round(F($(ee).scrollLeft())),Q),o=Math.min(Math.round(F(ee.offsetWidth+$(ee).scrollLeft())),Math.floor(te));$("#periodStart").val(r),$("#periodEnd").val(o),C()}function x(){for(;se>0;){var t=Math.round(F(se))-ue;if(Q>t)break;$("#tlDateMarkers").prepend(_(t)),se=W(t)}for(;le<ne.offsetWidth;){var e=Math.round(F(le))+ue;if(e>te)break;$("#tlDateMarkers").append(_(e)),le=W(e)}}function H(){for(;0>=se;){$("#tlDateMarkers > div.yearMarker:first").remove();var t=Math.round(F(se));se=W(t+ue)}for(;le>=ne.offsetWidth;){$("#tlDateMarkers > div.yearMarker:last").remove();var e=Math.round(F(le));le=W(e-ue)}}function _(t){var e=document.createElement("div");return e.setAttribute("id",t),e.setAttribute("class","yearMarker "+M(t)),e.style.left=W(t)+"px",e.innerHTML="<p>"+t+"</p>",e.markerDate={date:t},e}function M(t){return 0==t%(20*ue)?"yearMark1":0==t%(5*ue)?"yearMark2":"yearMark3"}function w(){t.onHiventsLoaded(function(t){for(var e=0;e<t.length;e++){var n=t[e].getHivent(),i=new Date(n.date),r=V(i),o=new HG.HiventMarkerTimeline(t[e],ne,r);Ce.push(o)}})}function C(){for(var t=0;t<Ce.length;t++){var e=new Date(Ce[t].getHiventHandle().getHivent().date),n=V(e);Ce[t].setPosition(n)}}function b(t,e){return 1==$(t.target).closest(e).length}function k(t){var e=$("#histPlayer1"),n=$("#histPlayer2"),i=$("#histPlayer3"),r=null;e.hasClass("active")&&(r=1),n.hasClass("active")&&(r=2),i.hasClass("active")&&(r=3);var o=null;b(t,e)&&(o=1),b(t,n)&&(o=2),b(t,i)&&(o=3),S(),1==o&&e.button("toggle"),2==o&&n.button("toggle"),3==o&&i.button("toggle"),r!=o&&(1==r&&e.button("toggle"),2==r&&n.button("toggle"),3==r&&i.button("toggle"),L(o))}function L(t){var e=0;ce=setInterval(function(){var n=W(He.date);n+=5*t;var i=0;if(he>n?i=he-n:n>ee.offsetWidth-he&&(i=ee.offsetWidth-he-n),0!=i){var o;setTimeout(o=function(){Math.abs(i)<1||(D(i/2),i/=2,setTimeout(o,20))},20)}if(r(n),He.date>=te){S();var a=$("#histPlayer1"),s=$("#histPlayer2"),l=$("#histPlayer3");a.hasClass("active")&&a.button("toggle"),s.hasClass("active")&&s.button("toggle"),l.hasClass("active")&&l.button("toggle")}50==e&&(m(),d(),e=0),e++},10)}function S(){clearInterval(ce),ce=null,$(He.marker).stop()}function T(t){return 1==t.which?($("body").attr("style","cursor: move;"),ye=t.pageX,pe=0,"nowMarkerMain"==t.target.id||"nowMarkerHead"==t.target.id?(de=!0,void 0):("polDate"!=t.target.id&&(me=!0),void 0)):void 0}function G(t){var e=t.pageX-ye;pe+=Math.abs(e),me&&(D(e),o()),de&&I(t),ye=t.pageX}function P(t){$("body").attr("style",""),(me||ge)&&d(),me&&5>pe&&i(Y(t));var e=$(He.marker).position().left-$(ee).scrollLeft(),n=0;if(he>e?n=he-e:e>ee.offsetWidth-he&&(n=ee.offsetWidth-he-e),0!=n){var r;setTimeout(r=function(){Math.abs(n)<1||(D(n/2),n/=2,setTimeout(r,50))},50)}i(),me=!1,de=!1,clearInterval(ge),ge=null}function E(t){var e=t,n=(new Date).getTime();clearInterval(ge),ge=setInterval(function(){var t=(new Date).getTime(),i=Math.min(.05,(t-n)/5e4);e>0?A(0,e+i):A(0,e-i),o()},20)}function z(t){var e=t,n=(new Date).getTime();clearInterval(ge),ge=setInterval(function(){var t=(new Date).getTime(),i=Math.min(.05,(t-n)/5e4);e>0?A($("#tlMain").width()-0,e+i):A($("#tlMain").width()-0,e-i),o()},20)}function D(t,e){var n=ne.offsetWidth/3;if(e||(t=Math.min(t,.382*ee.offsetWidth-(se-ee.scrollLeft)),t=Math.max(t,.618*ee.offsetWidth-(le-ee.scrollLeft))),0!=t){ee.scrollLeft-t<=0?(R(n),$("#tlMain").scrollLeft(ee.scrollLeft+n)):ee.scrollLeft-t>=ne.offsetWidth-ee.offsetWidth&&(R(-n),$("#tlMain").scrollLeft(ee.scrollLeft-n)),$("#tlMain").scrollLeft(ee.scrollLeft-t);var i=Math.ceil(F(ee.scrollLeft)),r=Math.floor(F(ee.scrollLeft+ee.offsetWidth));$("#periodStart").val(Math.max(i,Q)),$("#periodEnd").val(Math.min(r,Math.floor(te)))}}function R(t){var e=$("#tlDateMarkers > div");e.each(function(){$(this).css("left",W(this.markerDate.date)+t)}),oe+=t,se+=t,le+=t,C(),x(),H()}function I(t){var e=.2;if(xe=t,null===ge){var n=0;ge=setInterval(function(){var t=xe.pageX-$(ee).offset().left;if(he>t){var i=(he-t)*e;D(i)}else if(t>ee.offsetWidth-he){var i=(ee.offsetWidth-he-t)*e;D(i)}var o=t+$(ee).scrollLeft();r(o),0==++n%5&&(m(),d())},20)}}function A(t,e){var n={pageX:t+$("#tlMain").offset().left};U(n,e)}function U(t,e){t.preventDefault&&t.preventDefault();var n=1.15,i=ee.offsetWidth/B(Q,te),r=.45;t?(re=Y(t),oe=t.pageX-$("#tlScroller").offset().left):(re=F(ee.offsetWidth/2),oe=ee.offsetWidth/2),ae*=Math.pow(n,e),ae=Math.min(Math.max(ae,i),r),g(),o(),se-ee.scrollLeft>=.382*ee.offsetWidth?D(.382*ee.offsetWidth-(se-ee.scrollLeft)):le-ee.scrollLeft<=.618*ee.offsetWidth&&D(.618*ee.offsetWidth-(le-ee.scrollLeft)),o(),d()}function V(t){return t=X(t),B(re,t)*ae+oe}function W(t){return B(re,t)*ae+oe}function O(t){var e=re+(t-oe)/ae/365.242199;return j(e)}function F(t){return re+(t-oe)/ae/365.242199}function N(t){var e=j(t);return q(e.getDate())+"."+q(e.getMonth()+1)+"."+e.getFullYear()}function j(t){if(t instanceof Date)return t;var e=Math.floor(t);return K(e)?new Date(e,0,366*(t-e)+1,0,0,0):new Date(e,0,365*(t-e)+1,0,0,0)}function X(t){var e=t.getFullYear(),n=B(new Date(e,0,1),t);return K(e)?e+n/366:e+n/365}function Z(t){if(t instanceof Date)return X(t);if(!isNaN(t))return t;var e=String(t).split("."),n=new Date(e[2],e[1]-1,e[0]);return X(n)}function Y(t){var e=t.pageX-$("#tlScroller").offset().left;return F(e)}function B(t,e){0==t instanceof Date&&(t=j(t)),0==e instanceof Date&&(e=j(e));var n=e.getTime()-t.getTime();return n/864e5}function K(t){return 0==t%4?0==t%100?0==t%400?!0:!1:!0:!1}function q(t){return 10>t?"0"+t:t}var J={};J.initTimeline=e,J.resizeTimeline=n,J.drawScroller=g,J.setNowDate=i,J.setPeriod=a,J.setHistEvents=l,J.setMapExtent=s,J.getNow=h,J.getPeriodStart=u,J.getPeriodEnd=f,J.getCategories=c,J.addListener=v,J.catChangeHandler=y,J.clickMouse=T,J.moveMouse=G,J.releaseMouse=P,J.clickMoveButtonLeft=z,J.clickMoveButtonRight=E,J.zoom=U,J.togglePlayer=k;var Q,te,ee,ne,ie,re,oe,ae,se,le,he,ue,fe,ce,ve,me,de,ye,pe,ge,xe,He={},_e=[],Me=[],we=[],Ce=[];return J}!function(){null==window.HG&&(window.HG={}),HG.Display=function(){function t(){}return t.prototype.focus=function(t){return this.center({x:t.long,y:t.lat})},t}()}.call(this);var HG=HG||{};HG.Display2D=function(t,e){function n(){s=document.createElement("div"),s.style.width=$(t.parentNode).width()+"px",s.style.height=$(t.parentNode).height()+"px",t.appendChild(s),a=L.map(s,{maxZoom:7,minZoom:1,zoomControl:!1}).setView([51.505,10.09],4),a.attributionControl.setPrefix(""),L.tileLayer("data/tiles/{z}/{x}/{y}.png").addTo(a),u=!0}function i(){window.addEventListener("resize",o,!1)}function r(){e.onHiventsLoaded(function(t){for(var e=0;e<t.length;e++){var n=new HG.HiventMarker2D(t[e],l,a);h.push(n)}}),a.on("click",HG.deactivateAllHivents)}function o(){s.style.width=$(t.parentNode).width()+"px",s.style.height=$(t.parentNode).height()+"px"}HG.Display2D.MAX_ZOOM=1.5,HG.Display2D.MIN_ZOOM=.1,this.create=function(){n(),i(),r()},this.start=function(){u||(u=!0,s.style.display="block")},this.stop=function(){u=!1,s.style.display="none"},this.isRunning=function(){return u},this.getCanvas=function(){return s},this.center=function(t){a.panTo([t.y,t.x])};var a,s,l=this,h=[],u=!1;return HG.Display.call(this),this.create(),this},HG.Display2D.prototype=Object.create(HG.Display.prototype),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};null==window.HG&&(window.HG={}),HG.Display3D=function(e){function i(e,n){this._onMouseWheel=t(this._onMouseWheel,this),this.onMouseUp=t(this.onMouseUp,this),this.onMouseMove=t(this.onMouseMove,this),this.onMouseDown=t(this.onMouseDown,this),this.inContainer=e,this.inHiventHandler=n,this._initMembers(),this._initWindowGeometry(),this._initGlobe(),this._initRenderer(),this._initHivents(),this._initEventHandling(),this._zoom(),this.center({x:10,y:50})}var r,o,a,s,l,h,u,f,c,v,m,d,y;return n(i,e),i.prototype.start=function(){var t,e=this;return this._myIsRunning?void 0:(this._myIsRunning=!0,this._myRenderer.domElement.style.display="inline",t=function(){return e._myIsRunning?(e._render(),requestAnimationFrame(t)):void 0},t())},i.prototype.stop=function(){return this._myIsRunning=!1,HG.deactivateAllHivents(),this._myRenderer.domElement.style.display="none"},i.prototype.isRunning=function(){return this._myIsRunning},i.prototype.getCanvas=function(){return this._myRenderer.domElement},i.prototype.center=function(t){return this._myTargetCameraPos.x=t.x,this._myTargetCameraPos.y=t.y},i.prototype._initMembers=function(){return this._myWidth=null,this._myHeight=null,this._myCamera=null,this._myRenderer=null,this._mySceneGlobe=null,this._mySceneAtmosphere=null,this._myCanvasOffsetX=null,this._myCanvasOffsetY=null,this._myLastIntersected=[],this._myCurrentCameraPos={x:0,y:0},this._myTargetCameraPos={x:0,y:0},this._myMousePos={x:0,y:0},this._myMousePosLastFrame={x:0,y:0},this._myMouseSpeed={x:0,y:0},this._myDragStartPos=null,this._mySpringiness=.9,this._myCurrentFOV=0,this._myTargetFOV=0,this._myGlobeTextures=[],this._myGlobeUniforms=null,this._myIsRunning=!1,this._myCurrentZoom=u,this._myIsZooming=!1},i.prototype._initWindowGeometry=function(){return this._myWidth=this.inContainer.parentNode.offsetWidth,this._myHeight=this.inContainer.parentNode.offsetHeight,this._myCanvasOffsetX=this.inContainer.parentNode.offsetLeft,this._myCanvasOffsetY=this.inContainer.parentNode.offsetTop},i.prototype._initGlobe=function(){var t,e,n,i,a,s,h;return i=function(t,e,n,r,o){var a;return a={textures:null,loadedTextureCount:0,opacity:1,x:r(4),y:4*o,z:n,minLatLong:{x:t.x,y:t.y},maxLatLong:{x:t.x+e,y:t.y+e},children:null},n!==l&&(a.children=[],a.children.push(i({x:t.x,y:t.y+.5*e},.5*e,n+1,2*r,2*o)),a.children.push(i({x:t.x+.5*e,y:t.y+.5*e},.5*e,n+1,2*r+1,2*o)),a.children.push(i({x:t.x,y:t.y},.5*e,n+1,2*r,2*o+1)),a.children.push(i({x:t.x+.5*e,y:t.y},.5*e,n+1,2*r+1,2*o+1))),a},e=new THREE.SphereGeometry(c,64,32),s=d.earth,this._myCamera=new THREE.PerspectiveCamera(this._myCurrentFOV,this._myWidth/this._myHeight,1,1e4),this._myCamera.position.z=o,this._mySceneGlobe=new THREE.Scene,this._mySceneAtmosphere=new THREE.Scene,this._myGlobeUniforms=THREE.UniformsUtils.clone(s.uniforms),this._myGlobeTextures=i({x:0,y:0},1,2,0,0),a=new THREE.ShaderMaterial({vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,uniforms:this._myGlobeUniforms,transparent:!0}),n=new THREE.Mesh(e,a),n.matrixAutoUpdate=!1,this._mySceneGlobe.add(n),s=d.atmosphere,h=THREE.UniformsUtils.clone(s.uniforms),h.bgColor.value=new THREE.Vector3(r.r,r.g,r.b),a=new THREE.ShaderMaterial({uniforms:h,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader}),t=new THREE.Mesh(e,a),t.scale.x=t.scale.y=t.scale.z=1.5,t.flipSided=!0,t.matrixAutoUpdate=!1,t.updateMatrix(),this._mySceneAtmosphere.add(t)},i.prototype._initRenderer=function(){return this._myRenderer=new THREE.WebGLRenderer({antialias:!0}),this._myRenderer.autoClear=!1,this._myRenderer.setClearColor(r,1),this._myRenderer.setSize(this._myWidth,this._myHeight),this._myRenderer.domElement.style.position="absolute",this.inContainer.appendChild(this._myRenderer.domElement)},i.prototype._initEventHandling=function(){var t=this;return this._myRenderer.domElement.addEventListener("mousedown",this.onMouseDown,!1),this._myRenderer.domElement.addEventListener("mousemove",this.onMouseMove,!1),this._myRenderer.domElement.addEventListener("mousewheel",function(e){return e.preventDefault(),t._onMouseWheel(e.wheelDelta),!1},!1),this._myRenderer.domElement.addEventListener("DOMMouseScroll",function(e){return e.preventDefault(),t._onMouseWheel(30*-e.detail),!1},!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("mouseup",this.onMouseUp,!1)},i.prototype._initHivents=function(){var t=this;return this.inHiventHandler.onHiventsLoaded(function(e){var n,i,r,o,a,s;for(s=[],o=0,a=e.length;a>o;o++)n=e[o],i=new HG.HiventMarker3D(n,t,t.inContainer),r=t._latLongToCart({x:n.getHivent().long,y:n.getHivent().lat}),i.translateOnAxis(new THREE.Vector3(1,0,0),r.x),i.translateOnAxis(new THREE.Vector3(0,1,0),r.y),i.translateOnAxis(new THREE.Vector3(0,0,1),r.z),s.push(t._mySceneGlobe.add(i));return s})},i.prototype._render=function(){var t,e,n,i,r,a,s,l,h,u,f,c,d,y,p,g,x,H;for(r={x:2*((this._myMousePos.x-this._myCanvasOffsetX)/this._myWidth)-1,y:2*((this._myMousePos.y-this._myCanvasOffsetY)/this._myHeight)-1},f=new THREE.Vector3(r.x,-r.y,.5),v.unprojectVector(f,this._myCamera),m.set(this._myCamera.position,f.sub(this._myCamera.position).normalize()),n=m.intersectObjects(this._mySceneGlobe.children),a=[],c=0,p=n.length;p>c;c++)e=n[c],e.object instanceof HG.HiventMarker3D&&(t=$.inArray(e.object,this._myLastIntersected),t>=0&&this._myLastIntersected.splice(t,1));for(H=this._myLastIntersected,d=0,g=H.length;g>d;d++)e=H[d],e.getHiventHandle().unMark(e),e.getHiventHandle().unLinkAll();for(this._myLastIntersected=[],y=0,x=n.length;x>y;y++)e=n[y],e.object instanceof HG.HiventMarker3D&&(this._myLastIntersected.push(e.object),l={x:this._myMousePos.x-this._myCanvasOffsetX,y:this._myMousePos.y-this._myCanvasOffsetY},e.object.getHiventHandle().mark(e.object,l),e.object.getHiventHandle().linkAll(l));return this._myDragStartPos?(this._myMouseSpeed={x:.5*this._myMouseSpeed.x+.5*(this._myMousePos.x-this._myMousePosLastFrame.x),y:.5*this._myMouseSpeed.y+.5*(this._myMousePos.y-this._myMousePosLastFrame.y)},this._myMousePosLastFrame={x:this._myMousePos.x,y:this._myMousePos.y},i=this._pixelToLatLong(r),i?(s={x:this._myDragStartPos.x-i.x,y:this._myDragStartPos.y-i.y},s.y>180?s.y-=360:s.y<-180&&(yOffset+=360),this._myTargetCameraPos.y+=.5*s.x,this._myTargetCameraPos.x-=.5*s.y,this._clampCameraPos()):(this._myDragStartPos=null,container.style.cursor="auto")):0!==this._myMouseSpeed.x&&0!==this._myMouseSpeed.y&&(this._myTargetCameraPos.x-=.02*this._myMouseSpeed.x*this._myCurrentFOV,this._myTargetCameraPos.y+=.02*this._myMouseSpeed.y*this._myCurrentFOV,this._clampCameraPos(),this._myMouseSpeed={x:0,y:0}),this._myCurrentCameraPos={x:this._myCurrentCameraPos.x*this._mySpringiness+this._myTargetCameraPos.x*(1-this._mySpringiness),y:this._myCurrentCameraPos.y*this._mySpringiness+this._myTargetCameraPos.y*(1-this._mySpringiness)},h={x:this._myCurrentCameraPos.x*Math.PI/180,y:this._myCurrentCameraPos.y*Math.PI/180},this._myCamera.position={x:o*Math.sin(h.x+.5*Math.PI)*Math.cos(h.y),y:o*Math.sin(h.y),z:o*Math.cos(h.x+.5*Math.PI)*Math.cos(h.y)},this._myCamera.lookAt(new THREE.Vector3(0,0,0)),this._myCurrentFOV!==this._myTargetFOV&&(u=.8,this._myCurrentFOV=this._myCurrentFOV*u+this._myTargetFOV*(1-u),this._myCamera.fov=this._myCurrentFOV,this._myCamera.updateProjectionMatrix(),this._myIsZooming=!0,Math.abs(this._myCurrentFOV-this._myTargetFOV)<.05&&(this._myCurrentFOV=this._myTargetFOV,this._myIsZooming=!1)),this._myRenderer.clear(),this._myRenderer.setFaceCulling(THREE.CullFaceBack),this._myRenderer.setDepthTest(!1),this._myRenderer.setBlending(THREE.AlphaBlending),this._renderTile(this._myGlobeTextures),this._myRenderer.setDepthTest(!0),this._myRenderer.setFaceCulling(THREE.CullFaceFront),this._myRenderer.render(this._mySceneAtmosphere,this._myCamera)},i.prototype._zoom=function(){return this._myTargetFOV=(l-this._myCurrentZoom)/(l-u)*(a-h)+h},i.prototype.onMouseDown=function(t){var e;return this._myIsRunning&&(t.preventDefault(),e={x:2*((t.clientX-this._myCanvasOffsetX)/this._myWidth)-1,y:2*((t.clientY-this._myCanvasOffsetY)/this._myHeight)-1},this._myDragStartPos=this._pixelToLatLong(e),this._myDragStartPos)?(this.inContainer.style.cursor="move",this._mySpringiness=.1,this._myTargetCameraPos.x=this._myCurrentCameraPos.x,this._myTargetCameraPos.y=this._myCurrentCameraPos.y,this._myMousePosLastFrame.x=this._myMousePos.x,this._myMousePosLastFrame.y=this._myMousePos.y):void 0},i.prototype.onMouseMove=function(t){return this._myIsRunning?this._myMousePos={x:t.clientX,y:t.clientY}:void 0},i.prototype.onMouseUp=function(t){var e,n,i,r,o;if(this._myIsRunning){if(t.preventDefault(),this.inContainer.style.cursor="auto",this._mySpringiness=.9,this._myDragStartPos=null,this._myDragStartCamera=null,0===this._myLastIntersected.length)HG.deactivateAllHivents();else for(o=this._myLastIntersected,i=0,r=o.length;r>i;i++)e=o[i],n={x:this._myMousePos.x-this._myCanvasOffsetX,y:this._myMousePos.y-this._myCanvasOffsetY},e.getHiventHandle().activeAll(n);return!0}},i.prototype._onMouseWheel=function(t){return this._myIsRunning&&(this._myCurrentZoom=Math.max(Math.min(this._myCurrentZoom+.005*t,l),u),this._zoom()),!0},i.prototype._onWindowResize=function(){return this._myCamera.aspect=this.inContainer.parentNode.offsetWidth/this.inContainer.parentNode.offsetHeight,this._myCamera.updateProjectionMatrix(),this._myRenderer.setSize(this.inContainer.parentNode.offsetWidth,this.inContainer.parentNode.offsetHeight),this._initWindowGeometry()},i.prototype._clampCameraPos=function(){return this._myTargetCameraPos.y>s&&(this._myTargetCameraPos.y=s),this._myTargetCameraPos.y<-s?this._myTargetCameraPos.y=-s:void 0},i.prototype._isTileVisible=function(t,e){var n,i,r,o,a,s,l,h,u,f;return this._isFrontFacingTile(t,e)?(h=this._normalizedMercatusToNormalizedLatLong(t),a=this._normalizedMercatusToNormalizedLatLong(e),n=this._latLongToPixel(this._unNormalizeLatLong({x:h.x,y:h.y})),i=this._latLongToPixel(this._unNormalizeLatLong({x:a.x,y:h.y})),r=this._latLongToPixel(this._unNormalizeLatLong({x:a.x,y:a.y})),o=this._latLongToPixel(this._unNormalizeLatLong({x:h.x,y:a.y})),u=Math.min(Math.min(Math.min(n.x,i.x),r.x),o.x),s=Math.max(Math.max(Math.max(n.x,i.x),r.x),o.x),f=Math.min(Math.min(Math.min(n.y,i.y),r.y),o.y),l=Math.max(Math.max(Math.max(n.y,i.y),r.y),o.y),!(u>1||f>1||-1>s||-1>l)):!1},i.prototype._isFrontFacingTile=function(t,e){var n,i,r,o,a,s=this;return a=function(t){var e;return e=Math.acos(Math.sin((t.y-.5)*Math.PI)*Math.sin(s._myCurrentCameraPos.y*Math.PI/180)+Math.cos((t.y-.5)*Math.PI)*Math.cos(s._myCurrentCameraPos.y*Math.PI/180)*Math.cos(2*-(t.x-.5)*Math.PI+s._myCurrentCameraPos.x*Math.PI/180)),.5*Math.PI>e},n={x:t.x,y:t.y},i={x:e.x,y:t.y},r={x:e.x,y:e.y},o={x:t.x,y:e.y},a(n)||a(i)||a(r)||a(o)},i.prototype._tileChildrenLoaded=function(t){var e,n,i,r;for(r=t.children,n=0,i=r.length;i>n;n++)if(e=r[n],e.loadedTextureCount<16)return!1;return!0},i.prototype._tileLoad=function(t){var e,n,i,r,o,a,s;for(t.textures=[],e=0,s=[];4>e;){for(n=0;4>n;)o=t.x+e,a=t.y+(3-n),i=y+t.z+"/"+o+"/"+a+".png",r=THREE.ImageUtils.loadTexture(i,new THREE.UVMapping,function(){return t.loadedTextureCount++}),t.textures.push(r),++n;s.push(++e)}return s},i.prototype._tileLoadChildren=function(t){var e,n,i,r,o;for(r=t.children,o=[],n=0,i=r.length;i>n;n++)e=r[n],null==e.textures?o.push(this._tileLoad(e)):o.push(void 0);return o},i.prototype._renderTile=function(t){var e,n,i,r;if(this._isTileVisible(t.minLatLong,t.maxLatLong)){if(t.z<this._myCurrentZoom-.5&&null!=t.children){if(this._tileChildrenLoaded(t)){if(1!==t.opacity)for(r=t.children,n=0,i=r.length;i>n;n++)e=r[n],this._renderTile(e);if(t.opacity<.05)return t.opacity=0,void 0;this._myIsZooming||(t.opacity=.9*t.opacity)}this._myIsZooming||this._tileLoadChildren(t)}else t.opacity=1;return null==t.textures&&this._tileLoad(t),this._myGlobeUniforms.tiles.value=t.textures,this._myGlobeUniforms.opacity.value=t.opacity,this._myGlobeUniforms.minUV.value=t.minLatLong,this._myGlobeUniforms.maxUV.value=t.maxLatLong,this._myRenderer.render(this._mySceneGlobe,this._myCamera)}},i.prototype._pixelToLatLong=function(t){var e,n;return n=new THREE.Vector3(t.x,-t.y,.5),v.unprojectVector(n,this._myCamera),m.set(this._myCamera.position,n.sub(this._myCamera.position).normalize()),e=m.intersectObjects(this._mySceneGlobe.children),e.length>0?this._cartToLatLong(e[0].point.clone().normalize()):null},i.prototype._latLongToCart=function(t){var e,n,i;return e=c*Math.cos(t.y*Math.PI/180)*Math.cos(-t.x*Math.PI/180),n=c*Math.sin(t.y*Math.PI/180),i=c*Math.cos(t.y*Math.PI/180)*Math.sin(-t.x*Math.PI/180),new THREE.Vector3(e,n,i)},i.prototype._latLongToPixel=function(t){var e;return e=this._latLongToCart(t),v.projectVector(e,this._myCamera),e},i.prototype._cartToLatLong=function(t){var e,n;return e=180*(Math.asin(t.y)/Math.PI),n=180*(-Math.atan(t.x/t.z)/Math.PI)-90,t.z>0&&(n+=180),new THREE.Vector2(e,n)},i.prototype._normalizedLatLongToNormalizedMercatus=function(t){return 0===t.y?new THREE.Vector2(t.x,0):1===t.y?new THREE.Vector2(t.x,1):new THREE.Vector2(t.x,Math.log(Math.tan(.5*t.y*Math.PI))/(2*Math.PI)+.5)},i.prototype._normalizedMercatusToNormalizedLatLong=function(t){return 0===t.y?new THREE.Vector2(t.x,0):1===t.y?new THREE.Vector2(t.x,1):new THREE.Vector2(t.x,2/Math.PI*Math.atan(Math.exp(2*Math.PI*(t.y-.5))))},i.prototype._normalizeLatLong=function(t){return new THREE.Vector2(t.x/360+.5,t.y/180+.5)},i.prototype._unNormalizeLatLong=function(t){return new THREE.Vector2(360*t.x-180,180*t.y-90)},v=new THREE.Projector,m=new THREE.Raycaster,r=new THREE.Color(13421772),y="data/tiles/",c=200,o=500,l=7,u=3,a=60,h=4,s=80,f=.1,d={earth:{uniforms:{tiles:{type:"tv",value:[]},opacity:{type:"f",value:0},minUV:{type:"v2",value:null},maxUV:{type:"v2",value:null}},vertexShader:"varying vec3 vNormal;\nvarying vec2 vTexcoord;\n\nfloat convertCoords(float lat) {\n  if (lat == 0.0) return 0.0;\n  if (lat == 1.0) return 1.0;\n  const float pi = 3.1415926535897932384626433832795;\n  return log(tan(lat*0.5 * pi)) / (pi * 2.0) + 0.5;\n}\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vNormal = normalize( normalMatrix * normal );\n  vTexcoord = vec2(uv.x, convertCoords(uv.y));\n}",fragmentShader:"uniform sampler2D tiles[16];\nuniform float opacity;\nuniform vec2 minUV;\nuniform vec2 maxUV;\nvarying vec3 vNormal;\nvarying vec2 vTexcoord;\n\nvoid main() {\n\n  if (minUV.x > vTexcoord.x || maxUV.x < vTexcoord.x ||\n      minUV.y > vTexcoord.y || maxUV.y < vTexcoord.y)\n        discard;\n\n  vec2 uv = (vTexcoord - minUV)/(maxUV - minUV);\n  vec3 diffuse = vec3(0);\n  float size = 0.25;\n\n  if      (uv.x < 1.0*size && uv.y < 1.0*size)\n    diffuse = texture2D( tiles[ 0], uv * 4.0 - vec2(1, 1) + vec2(1, 1)).xyz;\n  else if (uv.x < 1.0*size && uv.y < 2.0*size)\n    diffuse = texture2D( tiles[ 1], uv * 4.0 - vec2(1, 2) + vec2(1, 1)).xyz;\n  else if (uv.x < 1.0*size && uv.y < 3.0*size)\n    diffuse = texture2D( tiles[ 2], uv * 4.0 - vec2(1, 3) + vec2(1, 1)).xyz;\n  else if (uv.x < 1.0*size && uv.y < 4.0*size)\n    diffuse = texture2D( tiles[ 3], uv * 4.0 - vec2(1, 4) + vec2(1, 1)).xyz;\n  else if (uv.x < 2.0*size && uv.y < 1.0*size)\n    diffuse = texture2D( tiles[ 4], uv * 4.0 - vec2(2, 1) + vec2(1, 1)).xyz;\n  else if (uv.x < 2.0*size && uv.y < 2.0*size)\n    diffuse = texture2D( tiles[ 5], uv * 4.0 - vec2(2, 2) + vec2(1, 1)).xyz;\n  else if (uv.x < 2.0*size && uv.y < 3.0*size)\n    diffuse = texture2D( tiles[ 6], uv * 4.0 - vec2(2, 3) + vec2(1, 1)).xyz;\n  else if (uv.x < 2.0*size && uv.y < 4.0*size)\n    diffuse = texture2D( tiles[ 7], uv * 4.0 - vec2(2, 4) + vec2(1, 1)).xyz;\n  else if (uv.x < 3.0*size && uv.y < 1.0*size)\n    diffuse = texture2D( tiles[ 8], uv * 4.0 - vec2(3, 1) + vec2(1, 1)).xyz;\n  else if (uv.x < 3.0*size && uv.y < 2.0*size)\n    diffuse = texture2D( tiles[ 9], uv * 4.0 - vec2(3, 2) + vec2(1, 1)).xyz;\n  else if (uv.x < 3.0*size && uv.y < 3.0*size)\n    diffuse = texture2D( tiles[10], uv * 4.0 - vec2(3, 3) + vec2(1, 1)).xyz;\n  else if (uv.x < 3.0*size && uv.y < 4.0*size)\n    diffuse = texture2D( tiles[11], uv * 4.0 - vec2(3, 4) + vec2(1, 1)).xyz;\n  else if (uv.x < 4.0*size && uv.y < 1.0*size)\n    diffuse = texture2D( tiles[12], uv * 4.0 - vec2(4, 1) + vec2(1, 1)).xyz;\n  else if (uv.x < 4.0*size && uv.y < 2.0*size)\n    diffuse = texture2D( tiles[13], uv * 4.0 - vec2(4, 2) + vec2(1, 1)).xyz;\n  else if (uv.x < 4.0*size && uv.y < 3.0*size)\n    diffuse = texture2D( tiles[14], uv * 4.0 - vec2(4, 3) + vec2(1, 1)).xyz;\n  else\n    diffuse = texture2D( tiles[15], uv * 4.0 - vec2(4, 4) + vec2(1, 1)).xyz;\n\n  float phong      = max(0.0, pow(dot( vNormal, normalize(vec3( -0.3, 0.4, 0.7))), 0.6))*0.4 + 0.65;\n  float specular   = max(0.0, pow(dot( vNormal, normalize(vec3( -0.3, 0.4, 0.7)) ), 60.0));\n  float atmosphere = pow(1.0 - dot( vNormal, vec3( 0.0, 0.0, 1.0 ) ), 2.0) * 0.7;\n  gl_FragColor     = vec4( phong * diffuse + atmosphere + specular * 0.1, opacity );\n}"},atmosphere:{uniforms:{bgColor:{type:"v3",value:r}},vertexShader:"varying vec3 vNormal;\nvoid main() {\n  vNormal = normalize( normalMatrix * normal );\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform vec3 bgColor;\nvarying vec3 vNormal;\n\nvoid main() {\n  float intensity = max(0.0, -0.05 + pow( -dot( vNormal, vec3( 0, 0, 1.0 ) ) + 0.5, 5.0 ));\n  gl_FragColor = vec4(vec3( 1.0, 1.0, 1.0) * intensity + bgColor * (1.0-intensity), 1.0 );\n}"}},i}(HG.Display)}.call(this);var HG=HG||{};HG.Histrip=function(t,e){return this.coords=t,this.category=e,this};var HG=HG||{};HG.HistripHandle=function(t){var e=!1,n=[],i=[];return this.getHistrip=function(){return t},this.hover=function(){if(!e){e=!0;for(var t=0;t<n.length;t++)n[t]()}},this.unHover=function(){if(e){e=!1;for(var t=0;t<i.length;t++)i[t]()}},this.onHover=function(t){t&&"function"==typeof t&&n.push(t)},this.onUnHover=function(t){t&&"function"==typeof t&&i.push(t)},this};var HG=HG||{};HG.HistripHandler=function(){this.create=function(){$.getJSON("data/histrips.json",function(i){for(var r=0;r<i.length;r++){var o=new HG.Histrip(i[r].coords,i[r].category);t.push(new HG.HistripHandle(o))}e=!0;for(var r=0;r<n.length;r++)n[r](t)})},this.getAllHistripHandles=function(){return t},this.onHistripsLoaded=function(i){i&&"function"==typeof i&&(e?i(t):n.push(i))};var t=[],e=!1,n=[];return this.create(),this};var HG=HG||{},HG=HG||{};HG.Hivent=function(t,e,n,i,r,o,a,s){return this.name=t,this.category=e,this.date=n,this.displayDate=i,this.long=r,this.lat=o,this.description=a,this.parties=s,this};var HG=HG||{};HG.activeHivents=[],HG.HiventHandle=function(t){var e=!1,n=!1,i=!1,r=!1,o=[],a=[],s=[],l=[],h=[],u=[],f=[],c=[],f=[];return this.getHivent=function(){return t},this.activeAll=function(t){e=!0,HG.activeHivents.push(this);for(var n=0;n<o.length;n++)for(var i=0;i<o[n][1].length;i++)o[n][1][i](t)},this.active=function(t,n){e=!0,HG.activeHivents.push(this);for(var i=0;i<o.length;i++)if(o[i][0]==t){for(var r=0;r<o[i][1].length;r++)o[i][1][r](n);break}},this.inActiveAll=function(t){e=!1;var n=$.inArray(this,HG.activeHivents);n>=0&&delete HG.activeHivents[n];for(var i=0;i<a.length;i++)for(var r=0;r<a[i][1].length;r++)a[i][1][r](t)},this.inActive=function(t,n){e=!1;var i=$.inArray(this,HG.activeHivents);i>=0&&delete HG.activeHivents[i];for(var r=0;r<a.length;r++)if(a[r][0]==t){for(var o=0;o<a[r][1].length;o++)a[r][1][o](n);break}},this.toggleActiveAll=function(t){e=!e,e?this.activeAll(t):this.inActiveAll(t)},this.toggleActive=function(t,n){e=!e,e?this.active(t,n):this.inActive(t,n)},this.markAll=function(t){if(!n){n=!0;for(var e=0;e<s.length;e++)for(var i=0;i<s[e][1].length;i++)s[e][1][i](t)}},this.mark=function(t,e){if(!n){n=!0;for(var i=0;i<s.length;i++)if(s[i][0]==t){for(var r=0;r<s[i][1].length;r++)s[i][1][r](e);break}}},this.unMarkAll=function(t){if(n){n=!1;for(var e=0;e<l.length;e++)for(var i=0;i<l[e][1].length;i++)l[e][1][i](t)}},this.unMark=function(t,e){if(n){n=!1;for(var i=0;i<l.length;i++)if(l[i][0]==t){for(var r=0;r<l[i][1].length;r++)l[i][1][r](e);break}}},this.linkAll=function(t){if(!i){i=!0;for(var e=0;e<h.length;e++)for(var n=0;n<h[e][1].length;n++)h[e][1][n](t)}},this.link=function(t,e){if(!i){i=!0;for(var n=0;n<h.length;n++)if(h[n][0]==t){for(var r=0;r<h[n][1].length;r++)h[n][1][r](e);break}}},this.unLinkAll=function(t,e){if(i){i=!1;for(var n=0;n<u.length;n++)for(var r=0;r<u[n][1].length;r++)u[n][1][r](e)}},this.unLink=function(t){if(i){i=!1;for(var e=0;e<u.length;e++)if(u[e][0]==obj){for(var n=0;n<u[e][1].length;n++)u[e][1][n](t);break}}},this.focusAll=function(t){r=!0;for(var e=0;e<c.length;e++)for(var n=0;n<c[e][1].length;n++)c[e][1][n](t)},this.focus=function(t,e){r=!0;for(var n=0;n<c.length;n++)if(c[n][0]==t){for(var i=0;i<c[n][1].length;i++)c[n][1][i](e);break}},this.unFocusAll=function(t){r=!1;for(var e=0;e<f.length;e++)for(var n=0;n<f[e][1].length;n++)f[e][1][n](t)},this.unFocus=function(t,e){r=!1;for(var n=0;n<f.length;n++)if(f[n][0]==t){for(var i=0;i<f[n][1].length;i++)f[n][1][i](e);break}},this.onActive=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<o.length;n++)if(o[n][0]==t)return o[n][1].push(e),void 0;o.push([t,[e]])}},this.onInActive=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<a.length;n++)if(a[n][0]==t)return a[n][1].push(e),void 0;a.push([t,[e]])}},this.onMark=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<s.length;n++)if(s[n][0]==t)return s[n][1].push(e),void 0;s.push([t,[e]])}},this.onUnMark=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<l.length;n++)if(l[n][0]==t)return l[n][1].push(e),void 0;l.push([t,[e]])}},this.onLink=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<h.length;n++)if(h[n][0]==t)return h[n][1].push(e),void 0;h.push([t,[e]])}},this.onUnLink=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<u.length;n++)if(u[n][0]==t)return u[n][1].push(e),void 0;
u.push([t,[e]])}},this.onFocus=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<c.length;n++)if(c[n][0]==t)return c[n][1].push(e),void 0;c.push([t,[e]])}},this.onUnFocus=function(t,e){if(e&&"function"==typeof e){for(var n=0;n<f.length;n++)if(f[n][0]==t)return f[n][1].push(e),void 0;f.push([t,[e]])}},this},HG.deactivateAllHivents=function(){for(var t=0;t<HG.activeHivents.length;t++)HG.activeHivents[t]&&HG.activeHivents[t].inActiveAll({x:0,y:0});HG.activeHivents=[]};var HG=HG||{};HG.HiventHandler=function(){function t(){$.getJSON("data/hivents.json",function(t){for(var r=0;r<t.length;r++){var o=new HG.Hivent(t[r].name,t[r].category,t[r].date,t[r].displayDate,t[r].long,t[r].lat,t[r].description,t[r].parties);e.push(new HG.HiventHandle(o))}n=!0;for(var r=0;r<i.length;r++)i[r](e)})}var e=[],n=!1,i=[];return this.getAllHiventHandles=function(){return e},this.onHiventsLoaded=function(t){t&&"function"==typeof t&&(n?t(e):i.push(t))},t(),this};var HG=HG||{};HG.hiventInfoCount=0,HG.HiventMarker=function(t,e){function n(){i=document.createElement("div"),i.class="btn",i.id="hiventInfo_"+HG.hiventInfoCount,i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.visibility="hidden",i.style.pointerEvents="none",e&&e.appendChild(i);var n=t.getHivent();$(i).tooltip({title:n.name,placement:"top"});var r='<p align="right">'+n.displayDate+"</p>"+n.description;$(i).popover({title:n.name,placement:"top",html:"true",content:r}),HG.hiventInfoCount++}var i,r=this;return this.getHiventHandle=function(){return t},this.showHiventName=function(t){i.style.left=t.x+"px",i.style.top=t.y+"px",$(i).tooltip("show")},this.hideHiventName=function(){$(i).tooltip("hide")},this.showHiventInfo=function(t){i.style.left=t.x+"px",i.style.top=t.y+"px",$(i).popover("show"),$(i).tooltip("hide")},this.hideHiventInfo=function(){$(i).popover("hide")},this.enableShowName=function(){t.onMark(r,this.showHiventName),t.onUnMark(r,this.hideHiventName)},this.enableShowInfo=function(){t.onActive(r,this.showHiventInfo),t.onInActive(r,this.hideHiventInfo)},n(),this};var HG=HG||{};HG.hiventMarker2DCount=0,HG.visibleMarkers2D=[],HG.HiventMarker2D=function(t,e,n){function i(){o=n.latLngToLayerPoint(r.getLatLng())}HG.HiventMarker.call(this,t,n.getPanes().popupPane),L.Marker.call(this,[t.getHivent().lat,t.getHivent().long]),this.addTo(n);var r=this,o=new L.Point(0,0);i();var a=40;return this.onMouseOver=function(){var t={x:o.x,y:o.y-a};r.getHiventHandle().mark(r,t),r.getHiventHandle().linkAll(t)},this.onMouseOut=function(){var t={x:o.x,y:o.y-a};r.getHiventHandle().unMark(r,t),r.getHiventHandle().unLinkAll(t)},this.onclick=function(){var t={x:o.x,y:o.y-a};r.getHiventHandle().toggleActive(r,t)},this.on("mouseover",r.onMouseOver),this.on("mouseout",r.onMouseOut),this.on("click",r.onclick),n.on("zoomend",i),n.on("dragend",i),n.on("viewreset",i),n.on("zoomstart",this.hideHiventInfo),HG.visibleMarkers2D.push(this),this.getHiventHandle().onMark(r,function(){}),this.getHiventHandle().onUnMark(r,function(){}),this.getHiventHandle().onLink(r,function(){}),this.getHiventHandle().onUnLink(r,function(){}),this.getHiventHandle().onFocus(r,function(){e.isRunning()&&e.focus(r.getHiventHandle().getHivent())}),this.enableShowName(),this.enableShowInfo(),this},HG.HiventMarker2D.prototype=Object.create(L.Marker.prototype);var HG=HG||{};HG.hiventMarkerGeometry=0,HG.HiventMarker3D=function(t,e,n){var i=this;0==HG.hiventMarkerGeometry&&(HG.hiventMarkerGeometry=new THREE.SphereGeometry(1,10,10));var r=new THREE.Vector3(.2,.2,.4),o=new THREE.Vector3(1,.5,0),a={hivent:{uniforms:{color:{type:"v3",value:null}},vertexShader:["varying vec3 vNormal;","void main() {","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 color;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4(color, 1.0);","}"].join("\n")}},s=a.hivent,l=THREE.UniformsUtils.clone(s.uniforms);l.color.value=r;var h=new THREE.ShaderMaterial({vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,uniforms:l});return HG.HiventMarker.call(this,t,n),THREE.Mesh.call(this,HG.hiventMarkerGeometry,h),this.getHiventHandle().onFocus(i,function(){e.isRunning()&&e.focus(i.getHiventHandle().getHivent())}),this.getHiventHandle().onMark(i,function(){l.color.value=o}),this.getHiventHandle().onUnMark(i,function(){l.color.value=r}),this.getHiventHandle().onLink(i,function(){l.color.value=o}),this.getHiventHandle().onUnLink(i,function(){l.color.value=r}),this.enableShowName(),this.enableShowInfo(),this},HG.HiventMarker3D.prototype=Object.create(THREE.Mesh.prototype);var HG=HG||{};HG.hiventMarkerTimelineCount=0,HG.visibleMarkers2D=[],HG.HiventMarkerTimeline=function(t,e,n){HG.HiventMarker.call(this,t,e);var i,r="#253563",o="#ff8800",a=this,s={x:n,y:Math.floor(.85*$(e.parentNode).innerHeight())},l=4;return i=document.createElement("div"),i.id="hiventMarkerTimeline_"+HG.hiventMarker2DCount,i.style.position="absolute",i.style.width=2*l+"px",i.style.height=2*l+"px",i.style.borderRadius=l+"px",i.style.backgroundColor=r,i.style.left=s.x+"px",i.style.top=s.y+"px",e.appendChild(i),i.onmouseover=function(){var t={x:s.x+l,y:s.y+.6*l};a.getHiventHandle().mark(a,t),a.getHiventHandle().linkAll(t)},i.onmouseout=function(){var t={x:s.x+l,y:s.y+.6*l};a.getHiventHandle().unMark(a,t),a.getHiventHandle().unLinkAll(t)},i.onclick=function(){var t={x:s.x+l,y:s.y+.6*l};a.getHiventHandle().focusAll(t)},HG.hiventMarkerTimelineCount++,this.getHiventHandle().onMark(a,function(){i.style.backgroundColor=o}),this.getHiventHandle().onUnMark(a,function(){i.style.backgroundColor=r}),this.getHiventHandle().onLink(a,function(){i.style.backgroundColor=o}),this.getHiventHandle().onUnLink(a,function(){i.style.backgroundColor=r}),this.enableShowName(),this.getPosition=function(){return s},this.setPosition=function(t){s.x=t,i.style.left=s.x+"px"},this.hide=function(){i.style.display="none"},this.show=function(){i.style.display="block"},this};var HG=HG||{};HG.VideoPlayer=function(t){function e(t){t.target.playVideo()}function n(){i=new YT.Player(r,{events:{onReady:e}})}var i,r=t;return this.stopVideo=function(){i.pauseVideo()},n(),this};var BrowserDetect={init:function(){this.canvasSupported=!!window.CanvasRenderingContext2D,this.webglContextSupported=!!window.WebGLRenderingContext,this.webglRenderingSupported=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(t){return!1}}();var t=this.searchString(this.dataBrowser)||{identity:"unknown"};this.browser=t.identity,this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.platformInfo=this.searchString(this.dataPlatform)||this.dataPlatform.unknown,this.platform=this.platformInfo.identity;var e=this.urls[this.browser];if(e){if(e.platforms){var t=e.platforms[this.platform];t&&(e=t)}}else e=this.urls.unknown;this.urls=e},searchString:function(t){for(var e=0;e<t.length;e++){var n=t[e],i=n.string,r=n.prop;if(this.versionSearchString=n.versionSearch||n.identity,i){if(-1!=i.indexOf(n.subString))return n}else if(r)return n}},searchVersion:function(t){var e=t.indexOf(this.versionSearchString);if(-1!=e)return parseFloat(t.substring(e+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Internet Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataPlatform:[{string:navigator.platform,subString:"Win",identity:"Windows",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"},{url:"http://www.google.com/chrome/",name:"Google Chrome"}]},{string:navigator.platform,subString:"Mac",identity:"Mac",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"},{url:"http://www.google.com/chrome/",name:"Google Chrome"},{url:"http://www.webkit.org/",name:"WebKit Developer Builds"}]},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"}]},{string:navigator.platform,subString:"iPad",identity:"iPad",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"}]},{string:navigator.userAgent,subString:"Android",identity:"Android",browsers:[{url:"https://market.android.com/details?id=org.mozilla.firefox",name:"Mozilla Firefox"},{url:"https://market.android.com/details?id=com.opera.browser",name:"Opera Mobile"}]},{string:navigator.platform,subString:"Linux",identity:"Linux",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"},{url:"http://www.google.com/chrome/",name:"Google Chrome"},{url:"http://www.opera.com/browser/next/",name:"Opera Next"}]},{string:"unknown",subString:"unknown",identity:"unknown",browsers:[{url:"http://www.mozilla.com/en-US/firefox/new/",name:"Mozilla Firefox"},{url:"http://www.google.com/chrome/",name:"Google Chrome"},{url:"http://www.opera.com/browser/next/",name:"Opera Next"},{url:"http://www.webkit.org/",name:"WebKit Developer Builds"}]}],urls:{Chrome:{upgradeUrl:"http://www.google.com/support/chrome/bin/answer.py?answer=95346",troubleshootingUrl:"http://www.google.com/support/chrome/bin/answer.py?answer=1220892"},Firefox:{upgradeUrl:"http://www.mozilla.com/en-US/firefox/new/",troubleshootingUrl:"https://support.mozilla.com/en-US/kb/how-do-i-upgrade-my-graphics-drivers"},Opera:{platforms:{Android:{upgradeUrl:"https://market.android.com/details?id=com.opera.browser",troubleshootingUrl:"http://www.opera.com/support/"}},upgradeUrl:"http://www.opera.com/browser/next/",troubleshootingUrl:"http://www.opera.com/support/"},Android:{upgradeUrl:null,troubleshootingUrl:null},Safari:{platforms:{"iPhone/iPod":{upgradeUrl:"http://www.apple.com/ios/",troubleshootingUrl:"http://www.apple.com/support/iphone/"},iPad:{upgradeUrl:"http://www.apple.com/ios/",troubleshootingUrl:"http://www.apple.com/support/ipad/"},Mac:{upgradeUrl:"http://www.webkit.org/",troubleshootingUrl:"http://www.webkit.org/blog/919/webgl-draft-specification-now-available/"}},upgradeUrl:"http://www.webkit.org/",troubleshootingUrl:"http://www.webkit.org/blog/919/webgl-draft-specification-now-available/"},unknown:{upgradeUrl:null,troubleshootingUrl:null}}};